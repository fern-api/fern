irVersion: v60
displayName: Ruby SDK
language: ruby
generatorType: SDK
defaultOutputMode: github
defaultCustomConfig:
  # wire tests cannot be run in seed containers due to docker-in-docker issues
  enableWireTests: false
image: fernapi/fern-ruby-sdk-v2
changelogLocation: ../../generators/ruby-v2/sdk/versions.yml

buildScripts:
  installScript:
    commands:
      - bundle install
  testScript:
    commands:
      - if [ -f wiremock/docker-compose.test.yml ]; then docker compose -f wiremock/docker-compose.test.yml down && docker compose -f wiremock/docker-compose.test.yml up -d; fi
      - bundle exec rake test
      - if [ -f wiremock/docker-compose.test.yml ]; then docker compose -f wiremock/docker-compose.test.yml down; fi

test:
  docker:
    image: fernapi/fern-ruby-sdk-v2:latest
    command: pnpm --filter @fern-api/ruby-sdk dockerTagLatest

publish:
  preBuildCommands:
    - pnpm --filter @fern-api/ruby-sdk dist:cli
  docker:
    file: ./generators/ruby-v2/sdk/Dockerfile
    image: fernapi/fern-ruby-sdk-v2
    context: .

scripts:
  - docker: fernapi/ruby-seed:1.0.0
    commands:
      - if [ -f wiremock/docker-compose.test.yml ]; then docker compose -f wiremock/docker-compose.test.yml down && docker compose -f wiremock/docker-compose.test.yml up -d; fi
      - bundle install
      - bundle exec rake test
      - if [ -f wiremock/docker-compose.test.yml ]; then docker compose -f wiremock/docker-compose.test.yml down; fi

fixtures:
  examples:
    - outputFolder: no-custom-config
      customConfig: null
    - outputFolder: readme-config
      customConfig:
        customReadmeSections:
          - title: "Override Section"
            content: "Override Content"
          - title: "Generator Invocation Custom Section"
            content: "Generator Invocation Custom Content for {{ packageName }}"
      readmeConfig:
        apiName: "CustomName"
        disabledSections:
          - "contributing"
        bannerLink: https://www.fernapi.com
        apiReferenceLink: https://www.docs.fernapi.com
        defaultEndpoint: POST /big-entity
        customSections:
          - title: "Base Readme Custom Section"
            language: ruby
            content: "Base Readme Custom Content for {{ packageName }}"
          - title: "Override Section"
            language: ruby
            content: "Base Content"
        features:
          timeouts:
            - GET /movie/{movieId}
            - method: POST
              path: /movie
  imdb:
    - outputFolder: with-wiremock-tests
      customConfig:
        enableWireTests: true
    - outputFolder: no-custom-config
      customConfig: null

allowedFailures: []
features:
  requestOptions: true
  idempotency: false
  autoPagination: false
  oauth: false
  authEnvVarScanning: true
  websocket: false
  streamingJson: false
  fileUpload: true
  fileDownload: true
  snippets: true
  snippetTests: true
  errors: false
  forwardCompatibleEnums: true
  additionalProperties: true
  whitelabel: false
  apiReferenceGeneration: false
