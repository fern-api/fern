displayName: TypeScript SDK
irVersion: v60
image: fernapi/fern-typescript-sdk
imageAliases: [fernapi/fern-typescript-node-sdk]
changelogLocation: ../../generators/typescript/sdk/versions.yml
publish:
  preBuildCommands:
    - pnpm --filter @fern-typescript/sdk-generator-cli dist:cli
  docker:
    file: ./generators/typescript/sdk/cli/Dockerfile
    image: fernapi/fern-typescript-sdk
    aliases: [fernapi/fern-typescript-node-sdk]
    context: .
test:
  docker:
    image: fernapi/fern-typescript-sdk:latest
    command:
      - pnpm --filter @fern-typescript/sdk-generator-cli dockerTagLatest
  local:
    workingDirectory: generators/typescript
    buildCommand:
      - pnpm --filter @fern-typescript/sdk-generator-cli dist:cli
    runCommand: node --enable-source-maps sdk/cli/dist/cli.cjs {CONFIG_PATH}
    env:
      NODE_ENV: test

language: typescript
generatorType: SDK
defaultOutputMode: github

customFixtureConfig:
  customConfig: {}
fixtures:
  imdb:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        omitUndefined: true
      outputFolder: omit-undefined
    - customConfig:
        noScripts: true
        extraDependencies:
          lodash: 4.17.21
      outputFolder: noScripts
    - customConfig:
        useBrandedStringAliases: true
      outputFolder: branded-string-aliases
  streaming:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig: null
      outputFolder: no-serde-layer
    - customConfig:
        allowCustomFetcher: true
        timeoutInSeconds: 2
      outputFolder: allow-custom-fetcher
    - outputFolder: wrapper
      customConfig:
        streamType: wrapper
        testFramework: jest
  audiences:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig: null
      audiences:
        - partner
      outputFolder: with-partner-audience
  exhaustive:
    - customConfig:
        packageManager: yarn
      outputFolder: use-yarn
    - customConfig:
        testFramework: jest
      outputFolder: use-jest
    - customConfig:
        omitFernHeaders: true
      outputFolder: omit-fern-headers
    - customConfig:
        packagePath: src/test-packagePath
      outputFolder: package-path
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig: null
      audiences:
        - audience1
        - audience2
      outputFolder: with-audiences
    - customConfig:
        noSerdeLayer: false
      outputFolder: serde-layer
    - customConfig:
        useBrandedStringAliases: true
        neverThrowErrors: true
        namespaceExport: 'Fiddle'
        bundle: true
        includeUtilsOnUnionMembers: true
        includeOtherInUnionTypes: true
        extraDependencies:
          lodash-es: '^4.17.21'
      outputFolder: bundle
    - customConfig:
        useBrandedStringAliases: true
        neverThrowErrors: true
        namespaceExport: 'Fiddle'
        bundle: true
        includeUtilsOnUnionMembers: true
        includeOtherInUnionTypes: true
        extraDependencies:
          lodash-es: '^4.17.21'
        packageJson:
          version: '0.0.2'
          dependencies:
            stream: '^0.0.2'
            qs: '^6.11.2'
          files:
            - exampleFile
            - dist
          browser:
            command-exists: false
            execa: false
          engines:
            node: '>=16.0.0'
      outputFolder: custom-package-json
    - customConfig:
        retainOriginalCasing: true
      outputFolder: retain-original-casing
    - customConfig:
        allowExtraFields: true
      outputFolder: allow-extra-fields
    - customConfig:
        useBrandedStringAliases: true
        neverThrowErrors: true
        namespaceExport: 'Fiddle'
        bundle: true
        includeUtilsOnUnionMembers: true
        includeOtherInUnionTypes: true
        extraDependencies:
          lodash-es: '^4.17.21'
        extraDevDependencies:
          jest: '^29.7.0'
        extraPeerDependencies:
          'openai': '^4.47.1'
        extraPeerDependenciesMeta:
          'openai':
            optional: true
      outputFolder: dev-dependencies
    - outputFolder: jsr
      customConfig:
        publishToJsr: true
    - outputFolder: bigint
      customConfig:
        useBigInt: true
        testFramework: jest
    - outputFolder: bigint-serde-layer
      customConfig:
        useBigInt: true
        noSerdeLayer: false
        testFramework: jest
    - outputFolder: web-stream-wrapper
      customConfig:
        streamType: web
    - outputFolder: node-fetch
      customConfig:
        fetchSupport: node-fetch
    - outputFolder: local-files
      outputMode: local_files
    - outputFolder: local-files-no-source
      outputMode: local_files
      customConfig:
        outputSourceFiles: false
    - customConfig:
        neverThrowErrors: true
      outputFolder: never-throw-errors
    - customConfig:
        exportAllRequestsAtRoot: true
      outputFolder: export-all-requests-at-root
    - customConfig:
        consolidateTypeFiles: true
      outputFolder: consolidate-type-files
  error-property:
    - customConfig:
        private: true
        includeUtilsOnUnionMembers: true
        includeOtherInUnionTypes: true
      outputFolder: union-utils
  undiscriminated-unions:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        skipResponseValidation: true
      outputFolder: skip-response-validation
  file-download:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        includeContentHeadersOnFileDownloadResponse: true
      outputFolder: file-download-response-headers
    - outputFolder: wrapper
      customConfig:
        streamType: wrapper
        testFramework: jest
    - customConfig:
        fileResponseType: 'stream'
      outputFolder: stream
  file-upload:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        inlineFileProperties: true
        inlinePathParameters: true
      outputFolder: inline
    - customConfig:
        noSerdeLayer: false
      outputFolder: serde
    - outputFolder: wrapper
      customConfig:
        streamType: wrapper
        testFramework: jest
    - outputFolder: form-data-node16
      customConfig:
        formDataSupport: 'Node16'
    - outputFolder: use-jest
      customConfig:
        testFramework: jest
  unknown:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        treatUnknownAsAny: true
      outputFolder: unknown-as-any
  query-parameters:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        noSerdeLayer: false
      outputFolder: serde-layer-query
  query-parameters-openapi:
    - customConfig: null
      outputFolder: no-custom-config
  query-parameters-openapi-as-objects:
    - customConfig: null
      outputFolder: no-custom-config
  request-parameters:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        useDefaultRequestParameterValues: true
      outputFolder: use-default-request-parameter-values
    - customConfig:
        useDefaultRequestParameterValues: true
        useBigInt: true
        testFramework: jest
      outputFolder: use-big-int-and-default-request-parameter-values
    - customConfig:
        flattenRequestParameters: true
      outputFolder: flatten-request-parameters
  trace:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        noSerdeLayer: false
      outputFolder: serde-trace
    - customConfig:
        noSerdeLayer: false
        neverThrowErrors: true
      outputFolder: serde-no-throwing
    - customConfig:
        useBrandedStringAliases: true
        neverThrowErrors: true
        includeCredentialsOnCrossOriginRequests: true
        includeUtilsOnUnionMembers: true
        includeOtherInUnionTypes: true
        timeoutInSeconds: 'infinity'
      outputFolder: exhaustive
  examples:
    - customConfig:
        includeApiReference: true
        customReadmeSections:
          - title: "Override Section"
            content: "Override Content"
          - title: "Generator Invocation Custom Section"
            content: "Generator Invocation Custom Content for {{ packageName }}"
      readmeConfig:
        apiName: "CustomName"
        disabledSections:
          - "contributing"
        bannerLink: https://www.fernapi.com
        apiReferenceLink: https://www.docs.fernapi.com
        defaultEndpoint: POST /movie
        customSections:
          - title: "Base Readme Custom Section"
            language: typescript
            content: "Base Readme Custom Content for {{ packageName }}"
          - title: "Override Section"
            language: typescript
            content: "Base Content"
        features:
          timeouts:
            - GET /movie/{movieId}
            - method: POST
              path: /movie
      outputFolder: examples-with-api-reference
    - customConfig:
        retainOriginalCasing: true
      outputFolder: retain-original-casing
  oauth-client-credentials:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        noSerdeLayer: false
      outputFolder: serde
  oauth-client-credentials-nested-root:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        neverThrowErrors: true
      outputFolder: never-throw-errors
  mixed-case:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        retainOriginalCasing: true
      outputFolder: retain-original-casing
  ts-inline-types:
    - customConfig:
        enableInlineTypes: true
      outputFolder: inline
    - customConfig:
        enableInlineTypes: false
      outputFolder: no-inline
  path-parameters:
    - outputFolder: default
    - customConfig:
        retainOriginalCasing: true
      outputFolder: retain-original-casing
    - customConfig:
        inlinePathParameters: true
      outputFolder: inline-path-parameters
    - customConfig:
        inlinePathParameters: true
        noSerdeLayer: false
      outputFolder: inline-path-parameters-serde
    - customConfig:
        inlinePathParameters: true
        retainOriginalCasing: true
      outputFolder: inline-path-parameters-retain-original-casing
  websocket:
    - outputFolder: no-websocket-clients
    - customConfig:
        noSerdeLayer: false
        shouldGenerateWebsocketClients: true
      outputFolder: serde
    - customConfig:
        noSerdeLayer: true
        shouldGenerateWebsocketClients: true
      outputFolder: no-serde
  property-access:
    - outputFolder: no-custom-config
      customConfig: null
    - customConfig:
        experimentalGenerateReadWriteOnlyTypes: true
      outputFolder: generate-read-write-only-types
  websocket-bearer-auth:
    - customConfig:
        shouldGenerateWebsocketClients: true
      outputFolder: websockets
  websocket-inferred-auth:
    - customConfig:
        shouldGenerateWebsocketClients: true
      outputFolder: websockets
  any-auth:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        generateEndpointMetadata: true
      outputFolder: generate-endpoint-metadata
scripts:
  - docker: fernapi/ts-seed
    commands:
      - |
        if grep -q '"packageManager": "pnpm' package.json; then
          mkdir -p .pnpm-cache
          echo "Enabling corepack and preparing pnpm..."
          corepack enable
          corepack prepare pnpm@10.14.0 --activate
          echo "Running pnpm install..."
          pnpm install --prefer-offline --frozen-lockfile
          echo "Running pnpm build..."
          if grep -q '"build":' package.json; then pnpm build; fi
          echo "Running pnpm test..."
          if grep -q '"test":' package.json; then pnpm test; fi
        fi
        if grep -q '"packageManager": "yarn' package.json; then
          mkdir -p .yarn-cache
          echo "Enabling corepack and preparing yarn..."
          corepack enable
          corepack prepare yarn@1.22.22 --activate
          echo "Running yarn install..."
          yarn install --prefer-offline --frozen-lockfile
          echo "Running yarn build..."
          if grep -q '"build":' package.json; then yarn build; fi
          echo "Running yarn test..."
          if grep -q '"test":' package.json; then yarn test; fi
        fi
allowedFailures:
  - accept-header
  - alias
  - alias-extends
  - api-wide-base-path
  - auth-environment-variables
  - basic-auth
  - basic-auth-environment-variables
  - bearer-token-environment-variable
  - bytes-upload
  - circular-references
  - circular-references-advanced
  - content-type
  - custom-auth
  - enum
  - error-property
  - error-property:union-utils
  - errors
  - exhaustive:bundle
  - exhaustive:custom-package-json
  - exhaustive:dev-dependencies
  - exhaustive:never-throw-errors
  - extends
  - file-download:file-download-response-headers
  - file-download:no-custom-config
  - file-download:stream
  - file-download:wrapper
  - literal
  - mixed-case:no-custom-config
  - mixed-case:retain-original-casing
  - oauth-client-credentials-custom
  - package-yml
  - pagination
  - query-parameters-openapi:no-custom-config
  - query-parameters-openapi-as-objects:no-custom-config
  - trace:no-custom-config
  - trace:serde-trace
  - trace:serde-no-throwing
  - trace:exhaustive
  - unions
  - version
  - version-no-default

  # the below are likely related to changes made to example generation
  - examples:examples-with-api-reference
  - examples:retain-original-casing

  # unknown
  - file-upload:no-custom-config
  - file-upload:inline
  - file-upload:serde
  - file-upload:wrapper
  - file-upload:form-data-node16
  - http-head
  - idempotency-headers
  - imdb:no-custom-config
  - imdb:omit-undefined
  - imdb:noScripts
  - imdb:branded-string-aliases
  - license
  - oauth-client-credentials:no-custom-config
  - ts-inline-types:inline
