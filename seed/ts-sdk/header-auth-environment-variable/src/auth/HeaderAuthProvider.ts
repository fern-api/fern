// This file was auto-generated by Fern from our API Definition.

import * as core from "../core/index.js";
import * as errors from "../errors/index.js";

const PARAM_KEY = "headerTokenAuth" as const;
const ENV_HEADER_KEY = "HEADER_TOKEN_ENV_VAR" as const;
const HEADER_NAME = "x-api-key" as const;

export class HeaderAuthProvider implements core.AuthProvider {
    private readonly options: HeaderAuthProvider.Options;

    constructor(options: HeaderAuthProvider.Options) {
        this.options = options;
    }

    public static canCreate(options: Partial<HeaderAuthProvider.Options>): boolean {
        return options?.[PARAM_KEY] != null || process.env?.[ENV_HEADER_KEY] != null;
    }

    public async getAuthRequest({ endpointMetadata }: {
            endpointMetadata?: core.EndpointMetadata;
        } = {}): Promise<core.AuthRequest> {

                const headerValue = 
                    (await core.Supplier.get(this.options[PARAM_KEY])) ??
                    process.env?.[ENV_HEADER_KEY];
                if (headerValue == null) {
                    throw new errors.SeedHeaderTokenEnvironmentVariableError({
                        message: HeaderAuthProvider.AUTH_CONFIG_ERROR_MESSAGE,
                    });
                }

                return {
                    headers: { [HEADER_NAME]: headerValue },
                };
                
    }
}

export namespace HeaderAuthProvider {
    export const AUTH_SCHEME = "Header" as const;
    export const AUTH_CONFIG_ERROR_MESSAGE: string = `Please provide '${PARAM_KEY}' when initializing the client, or set the '${ENV_HEADER_KEY}' environment variable` as const;
    export type Options = AuthOptions;
    export type AuthOptions = { [PARAM_KEY]?: core.Supplier<string> | undefined };

    export function createInstance(options: Options): core.AuthProvider {
        return new HeaderAuthProvider(options);
    }
}
