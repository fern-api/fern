// This file was auto-generated by Fern from our API Definition.

import { AuthClient } from "../api/resources/auth/client/Client.js";
import type { BaseClientOptions } from "../BaseClient.js";
import * as core from "../core/index.js";

export namespace InferredAuthProvider {
    export interface Options extends BaseClientOptions {}
}

export class InferredAuthProvider implements core.AuthProvider {
    private readonly client: AuthClient;
    private readonly options: InferredAuthProvider.Options;

    constructor(options: InferredAuthProvider.Options) {
        this.options = options;
        this.client = new AuthClient(options);
    }

    public async getAuthRequest(): Promise<core.AuthRequest> {
        return await this.getAuthRequestFromTokenEndpoint();
    }

    private async getAuthRequestFromTokenEndpoint(): Promise<core.AuthRequest> {
        const response = await this.client.getTokenWithClientCredentials({
            "X-Api-Key": await core.Supplier.get(this.options.xApiKey),
            client_id: await core.Supplier.get(this.options.clientId),
            client_secret: await core.Supplier.get(this.options.clientSecret),
            scope: await core.Supplier.get(this.options.scope),
        });
        return {
            headers: {
                Authorization: `Bearer ${response.access_token}`,
            },
        };
    }
}
