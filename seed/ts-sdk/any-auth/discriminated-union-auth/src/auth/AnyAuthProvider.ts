// This file was auto-generated by Fern from our API Definition.

import * as core from "../core/index.js";

export namespace AnyAuthProvider {
    export type AuthOptions = {
        auth:
            | { type: "Bearer"; token?: core.Supplier<core.BearerToken> }
            | { type: "ApiKey"; apiKey?: core.Supplier<string> }
            | { type: "OAuth"; clientId?: core.Supplier<string>; clientSecret?: core.Supplier<string> };
    };
}

export class AnyAuthProvider implements core.AuthProvider {
    private readonly delegate: core.AuthProvider;

    constructor(auth: AnyAuthProvider.AuthOptions["auth"]) {
        if (auth == null) {
            this.delegate = new core.NoOpAuthProvider();
            return;
        }
        switch (auth.type) {
            case "Bearer":
                this.delegate = {
                    getAuthRequest: async (): Promise<core.AuthRequest> => {
                        const tokenValue = auth.token;
                        const token = (await core.Supplier.get(tokenValue)) ?? process.env?.MY_TOKEN;
                        if (token != null) {
                            return { headers: { Authorization: `Bearer ${token}` } };
                        }
                        return { headers: {} };
                    },
                };
                break;
            case "ApiKey":
                this.delegate = {
                    getAuthRequest: async (): Promise<core.AuthRequest> => {
                        const headerValue = auth.apiKey;
                        const header = (await core.Supplier.get(headerValue)) ?? process.env?.MY_API_KEY;
                        if (header != null) {
                            return { headers: { "X-API-Key": header } };
                        }
                        return { headers: {} };
                    },
                };
                break;
            case "OAuth":
                throw new Error(
                    "OAuth authentication in AnyAuthProvider v2 is not yet supported. Please use the OAuth token endpoint directly.",
                );
            default: {
                const _exhaustive: never = auth;
                throw new Error(`Unknown auth type: ${(auth as any).type}`);
            }
        }
    }

    public async getAuthRequest(arg?: { endpointMetadata?: core.EndpointMetadata }): Promise<core.AuthRequest> {
        return this.delegate.getAuthRequest(arg);
    }
}
