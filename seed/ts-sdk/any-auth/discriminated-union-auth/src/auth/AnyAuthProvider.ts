// This file was auto-generated by Fern from our API Definition.

import type { BaseClientOptions } from "../BaseClient.js";
import * as core from "../core/index.js";
import { BearerAuthProvider } from "./BearerAuthProvider.js";
import { HeaderAuthProvider } from "./HeaderAuthProvider.js";
import { OAuthAuthProvider } from "./OAuthAuthProvider.js";

export namespace AnyAuthProvider {
    export type AuthOptions = {
        auth:
            | ({ type: "Bearer" } & BearerAuthProvider.AuthOptions)
            | ({ type: "ApiKey" } & HeaderAuthProvider.AuthOptions)
            | ({ type: "OAuth" } & OAuthAuthProvider.AuthOptions);
    };
}

export class AnyAuthProvider implements core.AuthProvider {
    private readonly delegate: core.AuthProvider;

    constructor(options: BaseClientOptions & AnyAuthProvider.AuthOptions) {
        const auth = options.auth;
        if (auth == null) {
            this.delegate = new core.NoOpAuthProvider();
            return;
        }
        switch (auth.type) {
            case "Bearer":
                this.delegate = new BearerAuthProvider({ ...options, token: auth.token });
                break;
            case "ApiKey":
                this.delegate = new HeaderAuthProvider({ ...options, apiKey: auth.apiKey });
                break;
            case "OAuth":
                this.delegate = new OAuthAuthProvider({
                    ...options,
                    clientId: auth.clientId,
                    clientSecret: auth.clientSecret,
                });
                break;
            default: {
                const _exhaustive: never = auth;
                throw new Error(`Unknown auth type: ${(auth as any).type}`);
            }
        }
    }

    public async getAuthRequest(arg?: { endpointMetadata?: core.EndpointMetadata }): Promise<core.AuthRequest> {
        return this.delegate.getAuthRequest(arg);
    }
}
