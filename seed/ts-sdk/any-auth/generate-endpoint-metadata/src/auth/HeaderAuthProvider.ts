// This file was auto-generated by Fern from our API Definition.

import * as core from "../core/index.js";
import * as errors from "../errors/index.js";

export namespace HeaderAuthProvider {
    export interface AuthOptions {
        apiKey?: core.EndpointSupplier<string> | undefined;
    }

    export interface Options extends AuthOptions {}
}

export class HeaderAuthProvider implements core.AuthProvider {
    private readonly headerValue: core.EndpointSupplier<string> | undefined;

    constructor(options: HeaderAuthProvider.Options) {
        this.headerValue = options.apiKey;
    }

    public static canCreate(options: HeaderAuthProvider.Options): boolean {
        return options.apiKey != null || process.env?.MY_API_KEY != null;
    }

    public static getAuthConfigErrorMessage(): string {
        return "Please provide 'auth.apiKey' or set the 'MY_API_KEY' environment variable";
    }

    public async getAuthRequest({
        endpointMetadata,
    }: {
        endpointMetadata?: core.EndpointMetadata;
    } = {}): Promise<core.AuthRequest> {
        const apiKey =
            (await core.EndpointSupplier.get(this.headerValue, { endpointMetadata })) ?? process.env?.MY_API_KEY;
        if (apiKey == null) {
            throw new errors.SeedAnyAuthError({
                message:
                    "Please specify a apiKey by either passing it in to the constructor or initializing a MY_API_KEY environment variable",
            });
        }

        const headerValue = apiKey;

        return {
            headers: { "X-API-Key": headerValue },
        };
    }
}
