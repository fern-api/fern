// This file was auto-generated by Fern from our API Definition.

import type * as core from "../core/index.js";
import type { BearerAuthProvider } from "./BearerAuthProvider.js";
import type { HeaderAuthProvider } from "./HeaderAuthProvider.js";
import type { OAuthAuthProvider } from "./OAuthAuthProvider.js";

export namespace AnyAuthProvider {
    type UnionToIntersection<U> = (U extends any ? (x: U) => void : never) extends (x: infer I) => void ? I : never;

    type AtLeastOneOf<T extends any[]> = {
        [K in keyof T]: T[K] & Partial<UnionToIntersection<Exclude<T[number], T[K]>>>;
    }[number];

    export type AuthOptions = AtLeastOneOf<
        [BearerAuthProvider.AuthOptions, HeaderAuthProvider.AuthOptions, OAuthAuthProvider.AuthOptions]
    >;
}

export class AnyAuthProvider implements core.AuthProvider {
    private readonly authProviders: core.AuthProvider[];

    constructor(authProviders: core.AuthProvider[]) {
        this.authProviders = authProviders;
    }

    public async getAuthRequest(arg?: { endpointMetadata?: core.EndpointMetadata }): Promise<core.AuthRequest> {
        const availableProviders = this.authProviders;

        for (const provider of availableProviders) {
            try {
                const authRequest = await provider.getAuthRequest(arg);
                if (authRequest.headers.Authorization != null || Object.keys(authRequest.headers).length > 0) {
                    return authRequest;
                }
            } catch (_e) {
                // Continue to next auth provider
            }
        }

        // No auth credentials found
        return { headers: {} };
    }
}
