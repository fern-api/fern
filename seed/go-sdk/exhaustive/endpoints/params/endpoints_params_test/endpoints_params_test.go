// Code generated by Fern. DO NOT EDIT.

package endpoints_params_test

import (
    http "net/http"
    bytes "bytes"
    json "encoding/json"
    os "os"
    testing "testing"
    client "github.com/exhaustive/fern/client"
    option "github.com/exhaustive/fern/option"
    context "context"
    require "github.com/stretchr/testify/require"
    endpoints "github.com/exhaustive/fern/endpoints"
)



func VerifyRequestCount(
    t *testing.T,
    testId string,
    method string,
    urlPath string,
    queryParams map[string]string,
    expected int,
) {
    wiremockPort := os.Getenv("WIREMOCK_PORT")
    	if wiremockPort == "" {
    		wiremockPort = "8080"
    	}
    	WiremockAdminURL := "http://localhost:" + wiremockPort + "/__admin"
    var reqBody bytes.Buffer
    reqBody.WriteString(`{"method":"`)
    reqBody.WriteString(method)
    reqBody.WriteString(`","urlPath":"`)
    reqBody.WriteString(urlPath)
    reqBody.WriteString(`","headers":{"X-Test-Id":{"equalTo":"`)
    reqBody.WriteString(testId)
    reqBody.WriteString(`"}}`)
    if len(queryParams) > 0 {
        reqBody.WriteString(`,"queryParameters":{`)
        first := true
        for key, value := range queryParams {
            if !first {
                reqBody.WriteString(",")
            }
            reqBody.WriteString(`"`)
            reqBody.WriteString(key)
            reqBody.WriteString(`":{"equalTo":"`)
            reqBody.WriteString(value)
            reqBody.WriteString(`"}`)
            first = false
        }
        reqBody.WriteString("}")
    }
    reqBody.WriteString("}")
    resp, err := http.Post(WiremockAdminURL+"/requests/find", "application/json", &reqBody)
    require.NoError(t, err)
    var result struct { Requests []interface{} `json:"requests"` }
    json.NewDecoder(resp.Body).Decode(&result)
    require.Equal(t, expected, len(result.Requests))
}

func TestEndpointsParamsGetWithPathWithWireMock(
    t *testing.T,
) {
    wiremockPort := os.Getenv("WIREMOCK_PORT")
    	if wiremockPort == "" {
    		wiremockPort = "8080"
    	}
    	WireMockBaseURL := "http://localhost:" + wiremockPort
        client := client.NewClient(
            option.WithBaseURL(
                WireMockBaseURL,
            ),
        )
    _, invocationErr :=     client.Endpoints.Params.GetWithPath(
            context.TODO(),
            "param",
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TestEndpointsParamsGetWithPathWithWireMock"}},
            ),
        )

    require.NoError(t, invocationErr, "Client method call should succeed")
    VerifyRequestCount(t, "TestEndpointsParamsGetWithPathWithWireMock", "GET", "/params/path/param", nil, 1)
}

func TestEndpointsParamsGetWithPathWithWireMock2(
    t *testing.T,
) {
    wiremockPort := os.Getenv("WIREMOCK_PORT")
    	if wiremockPort == "" {
    		wiremockPort = "8080"
    	}
    	WireMockBaseURL := "http://localhost:" + wiremockPort
        client := client.NewClient(
            option.WithBaseURL(
                WireMockBaseURL,
            ),
        )
    _, invocationErr :=     client.Endpoints.Params.GetWithPath(
            context.TODO(),
            "param",
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TestEndpointsParamsGetWithPathWithWireMock2"}},
            ),
        )

    require.NoError(t, invocationErr, "Client method call should succeed")
    VerifyRequestCount(t, "TestEndpointsParamsGetWithPathWithWireMock2", "GET", "/params/path/param", nil, 1)
}

func TestEndpointsParamsGetWithQueryWithWireMock(
    t *testing.T,
) {
    wiremockPort := os.Getenv("WIREMOCK_PORT")
    	if wiremockPort == "" {
    		wiremockPort = "8080"
    	}
    	WireMockBaseURL := "http://localhost:" + wiremockPort
        client := client.NewClient(
            option.WithBaseURL(
                WireMockBaseURL,
            ),
        )
        request := &endpoints.GetWithQuery{
            Query: "query",
            Number: 1,
        }
    invocationErr :=     client.Endpoints.Params.GetWithQuery(
            context.TODO(),
            request,
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TestEndpointsParamsGetWithQueryWithWireMock"}},
            ),
        )

    require.NoError(t, invocationErr, "Client method call should succeed")
    VerifyRequestCount(t, "TestEndpointsParamsGetWithQueryWithWireMock", "GET", "/params", map[string]string{"query": "query", "number": "1"}, 1)
}

func TestEndpointsParamsGetWithQueryWithWireMock2(
    t *testing.T,
) {
    wiremockPort := os.Getenv("WIREMOCK_PORT")
    	if wiremockPort == "" {
    		wiremockPort = "8080"
    	}
    	WireMockBaseURL := "http://localhost:" + wiremockPort
        client := client.NewClient(
            option.WithBaseURL(
                WireMockBaseURL,
            ),
        )
        request := &endpoints.GetWithQuery{
            Query: "query",
            Number: 1,
        }
    invocationErr :=     client.Endpoints.Params.GetWithQuery(
            context.TODO(),
            request,
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TestEndpointsParamsGetWithQueryWithWireMock2"}},
            ),
        )

    require.NoError(t, invocationErr, "Client method call should succeed")
    VerifyRequestCount(t, "TestEndpointsParamsGetWithQueryWithWireMock2", "GET", "/params", map[string]string{"query": "query", "number": "1"}, 1)
}

func TestEndpointsParamsGetWithPathAndQueryWithWireMock(
    t *testing.T,
) {
    wiremockPort := os.Getenv("WIREMOCK_PORT")
    	if wiremockPort == "" {
    		wiremockPort = "8080"
    	}
    	WireMockBaseURL := "http://localhost:" + wiremockPort
        client := client.NewClient(
            option.WithBaseURL(
                WireMockBaseURL,
            ),
        )
        request := &endpoints.GetWithPathAndQuery{
            Query: "query",
        }
    invocationErr :=     client.Endpoints.Params.GetWithPathAndQuery(
            context.TODO(),
            "param",
            request,
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TestEndpointsParamsGetWithPathAndQueryWithWireMock"}},
            ),
        )

    require.NoError(t, invocationErr, "Client method call should succeed")
    VerifyRequestCount(t, "TestEndpointsParamsGetWithPathAndQueryWithWireMock", "GET", "/params/path-query/param", map[string]string{"query": "query"}, 1)
}

func TestEndpointsParamsGetWithPathAndQueryWithWireMock2(
    t *testing.T,
) {
    wiremockPort := os.Getenv("WIREMOCK_PORT")
    	if wiremockPort == "" {
    		wiremockPort = "8080"
    	}
    	WireMockBaseURL := "http://localhost:" + wiremockPort
        client := client.NewClient(
            option.WithBaseURL(
                WireMockBaseURL,
            ),
        )
        request := &endpoints.GetWithPathAndQuery{
            Query: "query",
        }
    invocationErr :=     client.Endpoints.Params.GetWithPathAndQuery(
            context.TODO(),
            "param",
            request,
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TestEndpointsParamsGetWithPathAndQueryWithWireMock2"}},
            ),
        )

    require.NoError(t, invocationErr, "Client method call should succeed")
    VerifyRequestCount(t, "TestEndpointsParamsGetWithPathAndQueryWithWireMock2", "GET", "/params/path-query/param", map[string]string{"query": "query"}, 1)
}

func TestEndpointsParamsModifyWithPathWithWireMock(
    t *testing.T,
) {
    wiremockPort := os.Getenv("WIREMOCK_PORT")
    	if wiremockPort == "" {
    		wiremockPort = "8080"
    	}
    	WireMockBaseURL := "http://localhost:" + wiremockPort
        client := client.NewClient(
            option.WithBaseURL(
                WireMockBaseURL,
            ),
        )
        request := "string"
        client.Endpoints.Params.ModifyWithPath(
            context.TODO(),
            "param",
            request,
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TEST-ID-PLACEHOLDER"}},
    _, invocationErr :=     client.Endpoints.Params.ModifyWithPath(
            context.TODO(),
            "param",
            request,
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TestEndpointsParamsModifyWithPathWithWireMock"}},
            ),
        )

    require.NoError(t, invocationErr, "Client method call should succeed")
    VerifyRequestCount(t, "TestEndpointsParamsModifyWithPathWithWireMock", "PUT", "/params/path/param", nil, 1)
}

func TestEndpointsParamsModifyWithPathWithWireMock2(
    t *testing.T,
) {
    wiremockPort := os.Getenv("WIREMOCK_PORT")
    	if wiremockPort == "" {
    		wiremockPort = "8080"
    	}
    	WireMockBaseURL := "http://localhost:" + wiremockPort
        client := client.NewClient(
            option.WithBaseURL(
                WireMockBaseURL,
            ),
        )
        request := "string"
        client.Endpoints.Params.ModifyWithPath(
            context.TODO(),
            "param",
            request,
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TEST-ID-PLACEHOLDER"}},
    _, invocationErr :=     client.Endpoints.Params.ModifyWithPath(
            context.TODO(),
            "param",
            request,
            option.WithHTTPHeader(
                http.Header{"X-Test-Id": []string{"TestEndpointsParamsModifyWithPathWithWireMock2"}},
            ),
        )

    require.NoError(t, invocationErr, "Client method call should succeed")
    VerifyRequestCount(t, "TestEndpointsParamsModifyWithPathWithWireMock2", "PUT", "/params/path/param", nil, 1)
}


