// Code generated by Fern. DO NOT EDIT.

package pagination_test

import (
	"context"
	"testing"

	client "github.com/pagination/fern/client"
	fern "github.com/pagination/fern"
	option "github.com/pagination/fern/option"
	assert "github.com/stretchr/testify/assert"
)

func TestRawResponseAccess(t *testing.T) {
	// This test demonstrates accessing page.RawResponse.Next
	// to get the next cursor from a paginated response
	t.Run("access raw response next cursor", func(t *testing.T) {
		c := client.NewClient(
			option.WithBaseURL("https://api.example.com"),
		)

		ctx := context.TODO()
		request := &fern.ListUsersCursorPaginationRequest{
			Page:          fern.Int(1),
			PerPage:       fern.Int(10),
			StartingAfter: fern.String("cursor_123"),
		}

		// Call the paginated endpoint
		page, err := c.Users.ListWithCursorPagination(ctx, request)

		// In a real test with a mock server, we would get a valid response
		// For this compilation test, we just show the types are correct
		if err != nil {
			// Expected in this test since we don't have a real server
			assert.Error(t, err)
			return
		}

		// Access the next cursor from the RawResponse
		// This demonstrates the exact pattern from the README
		nextCursor := page.RawResponse.Next

		// Verify the type is correct (*string for cursor-based pagination)
		assert.NotNil(t, page)
		_ = nextCursor // nextCursor is of type *string
	})
}

func TestRawResponseNextCursorPattern(t *testing.T) {
	// This test replicates the exact functionality from the request:
	// ctx := context.TODO()
	// page, err := client.Complex.Search(ctx, ...)
	// if err != nil {
	//     return err
	// }
	// nextCursor := page.RawResponse.Next

	t.Run("exact pattern from request", func(t *testing.T) {
		c := client.NewClient(
			option.WithBaseURL("https://api.example.com"),
		)

		ctx := context.TODO()
		page, err := c.Users.ListWithCursorPagination(
			ctx,
			&fern.ListUsersCursorPaginationRequest{
				PerPage: fern.Int(10),
			},
		)
		if err != nil {
			// In production code, you would handle the error
			// For this test, we just demonstrate the pattern compiles
			assert.Error(t, err)
			return
		}

		// Access the next cursor directly from the raw response
		nextCursor := page.RawResponse.Next

		// Use the nextCursor for subsequent pagination requests
		if nextCursor != nil {
			nextPage, err := c.Users.ListWithCursorPagination(
				ctx,
				&fern.ListUsersCursorPaginationRequest{
					PerPage:       fern.Int(10),
					StartingAfter: nextCursor,
				},
			)
			if err != nil {
				assert.Error(t, err)
				return
			}
			assert.NotNil(t, nextPage)
		}
	})
}
