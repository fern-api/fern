irVersion: v60
displayName: Go SDK
image: fernapi/fern-go-sdk
changelogLocation: ../../generators/go/sdk/versions.yml

buildScripts:
  compileScript:
    commands:
      - go build -v ./...
  testScript:
    commands:
      - docker compose -f wiremock/docker-compose.test.yml down && docker compose -f wiremock/docker-compose.test.yml up -d || true 
      - go test -v ./...
      - docker compose -f wiremock/docker-compose.test.yml down
publish:
  workingDirectory: generators/go
  preBuildCommands:
    - go build ./...
    - pnpm --filter @fern-api/go-sdk dist:cli
  docker:
    file: ./generators/go/sdk/Dockerfile
    image: fernapi/fern-go-sdk
    context: .
test:
  docker:
    image: fernapi/fern-go-sdk:latest
    command: pnpm --filter @fern-api/go-sdk dist:cli && docker build -f ./generators/go/sdk/Dockerfile -t fernapi/fern-go-sdk:latest .
language: go
generatorType: SDK
defaultOutputMode: github
defaultCustomConfig:
  # wire tests cannot be run in seed containers due to docker-in-docker issues
  enableWireTests: false
fixtures:
  examples:
    - outputFolder: no-custom-config
      customConfig: null
    - outputFolder: v0
      customConfig:
        alwaysSendRequiredProperties: false
        inlineFileProperties: false
        inlinePathParameters: false
        useReaderForBytesRequest: false
        union: v0
    - outputFolder: always-send-required-properties
      customConfig:
        alwaysSendRequiredProperties: true
    - outputFolder: exported-client-name
      customConfig:
        exportedClientName: AcmeClient
    - outputFolder: client-name
      customConfig:
        clientName: Acme
    - outputFolder: client-name-with-custom-constructor-name
      customConfig:
        clientName: Acme
        clientConstructorName: New
    - outputFolder: readme-config
      customConfig:
        clientName: Acme
        clientConstructorName: New
        customReadmeSections:
          - title: "Generator Invocation Custom Section"
            content: "Generator Invocation Custom Content for {{ owner }}:{{ repo }}:{{ version }}"
          - title: "Override Section"
            content: "Override Content"
      readmeConfig:
        apiName: "CustomName"
        disabledSections:
          - "contributing"
        bannerLink: https://www.fernapi.com
        apiReferenceLink: https://www.docs.fernapi.com
        defaultEndpoint: POST /big-entity
        customSections:
          - title: "Base Readme Custom Section"
            language: go
            content: "Base Readme Custom Content for {{ owner }}:{{ repo }}:{{ version }}"
          - title: "Override Section"
            language: go
            content: "Base Content"
        features:
          timeouts:
            - GET /movie/{movieId}
            - method: POST
              path: /movie
    - outputFolder: package-path
      customConfig:
        packagePath: pleaseinhere
    - outputFolder: getters-pass-by-value
      customConfig:
        gettersPassByValue: true
    - outputFolder: export-all-requests-at-root
      customConfig:
        exportAllRequestsAtRoot: true
  go-bytes-request:
    - outputFolder: no-custom-config
      customConfig: null
    - outputFolder: use-reader-for-bytes-request
      customConfig:
        useReaderForBytesRequest: true
  imdb:
    - outputFolder: with-wiremock-tests
      customConfig:
        enableWireTests: true
    - outputFolder: no-custom-config
      customConfig: null
    - outputFolder: package-path
      customConfig:
        packagePath: inhereplease
    - outputFolder: deep-package-path
      customConfig: 
        packagePath: all/the/way/in/here/please
  undiscriminated-unions:
    - outputFolder: no-custom-config
      outputVersion: 0.0.1
      customConfig:
        packageName: undiscriminated
        module:
          path: github.com/fern-api/undiscriminated-go
    - outputFolder: v0
      customConfig:
        alwaysSendRequiredProperties: false
        inlineFileProperties: false
        inlinePathParameters: false
        useReaderForBytesRequest: false
        union: v0
  unions:
    - outputFolder: no-custom-config
      customConfig: null
    - outputFolder: v0
      customConfig:
        alwaysSendRequiredProperties: false
        inlineFileProperties: false
        inlinePathParameters: false
        useReaderForBytesRequest: false
        union: v0
    - outputFolder: package-name
      outputVersion: 0.0.1
      customConfig:
        packageName: unions
        module:
          path: github.com/fern-api/unions-go
  file-upload:
    - outputFolder: no-custom-config
      customConfig: null
    - outputFolder: v0
      customConfig:
        alwaysSendRequiredProperties: false
        inlineFileProperties: false
        inlinePathParameters: false
        useReaderForBytesRequest: false
        union: v0
    - outputFolder: package-name
      outputVersion: 0.0.1
      customConfig:
        packageName: upload
        module:
          path: github.com/fern-api/file-upload-go
  path-parameters:
    - outputFolder: no-custom-config
      customConfig: null
    - outputFolder: v0
      customConfig:
        alwaysSendRequiredProperties: false
        inlineFileProperties: false
        inlinePathParameters: false
        useReaderForBytesRequest: false
        union: v0
    - outputFolder: package-name
      outputVersion: 0.0.1
      customConfig:
        packageName: path
        module:
          path: github.com/fern-api/path-parameters-go
  package-yml:
    - outputFolder: no-custom-config
      customConfig: null
  streaming:
    - outputFolder: .
      outputVersion: v2.0.0
      customConfig:
        packageName: stream
        module:
          path: github.com/fern-api/stream-go
  idempotency-headers:
    - outputFolder: .
      outputVersion: 0.0.1
      customConfig:
        packageName: fern
        module:
          path: github.com/idempotency-headers/fern
        includeLegacyClientOptions: true
  literals-unions:
    - outputFolder: no-custom-config
      customConfig: null
  mixed-case:
    - outputFolder: no-custom-config
      customConfig: null
    - outputFolder: default-values
      customConfig:
        useDefaultRequestParameterValues: true
scripts:
  - docker: fernapi/go-seed:1.0.0
    commands:
      - docker compose -f wiremock/docker-compose.test.yml down && docker compose -f wiremock/docker-compose.test.yml up -d || true
      - CGO_ENABLED=0 go test ./...
      - docker compose -f wiremock/docker-compose.test.yml down || true
allowedFailures:
  - alias-extends
  - bytes-download
  - enum
  - errors
  - exhaustive
  - literal
  - mixed-case:no-custom-config
  - mixed-case:default-values
  - pagination-custom
  - request-parameters
  - reserved-keywords
  - server-sent-event-examples
  - server-sent-events
  - streaming-parameter
  - trace
  - property-access

  # TODO: Fix example generator to produce valid dynamic snippets.
  - pagination

  # TODO: Update the dynamic snippet generator to handle these cases.
  - examples:exported-client-name
  - path-parameters:no-custom-config
  - path-parameters:package-name

  - oauth-client-credentials-with-variables
  - variables

  # Will include these back in once we fix dynamic snippets for inline file properties
  - file-upload:no-custom-config 
  - file-upload:package-name 
  - file-upload-openapi
