displayName: Swift SDK
irVersion: v59
image: fernapi/fern-swift-sdk
changelogLocation: ../../generators/swift/sdk/versions.yml

publish:
  preBuildCommands:
    - pnpm --filter @fern-api/swift-sdk dist:cli
  docker:
    file: ./generators/swift/sdk/Dockerfile
    image: fernapi/fern-swift-sdk
    context: .

test:
  docker:
    image: fernapi/fern-swift-sdk:latest
    command: pnpm --filter @fern-api/swift-sdk dockerTagLatest
  local:
    workingDirectory: generators/swift
    buildCommand:
      - pnpm --filter @fern-api/swift-sdk dist:cli
    runCommand: node --enable-source-maps sdk/dist/cli.cjs {CONFIG_PATH}

language: swift
generatorType: SDK
defaultOutputMode: github
defaultCustomConfig: {}

scripts:
  - docker: swift:6.1.2
    commands:
      # On Linux, URLSession/URLRequest require explicit FoundationNetworking import
      # The Swift generator only outputs "import Foundation" but Linux needs both imports
      - find . -name "*.swift" -exec sed -i '1s/^import Foundation$/import Foundation\nimport FoundationNetworking/' {} \;
      - swift build -c release --build-tests
      - swift test

fixtures:
  client-side-params:
    - customConfig:
        moduleName: MyCustomModule
        clientClassName: MyCustomClient
      outputFolder: with-custom-config
    - customConfig: null
      outputFolder: no-custom-config
  examples:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        customReadmeSections:
          - title: "Override Section"
            content: "Override Content"
          - title: "Generator Invocation Custom Section"
            content: "Generator Invocation Custom Content for {{ gitUrl }}:{{ minVersion }}"
      readmeConfig:
        apiName: "CustomName"
        disabledSections:
          - apiReference
        bannerLink: https://www.fernapi.com
        apiReferenceLink: https://www.docs.fernapi.com
        defaultEndpoint: POST /movie
        customSections:
          - title: "Base Readme Custom Section"
            language: swift
            content: "Base Readme Custom Content for {{ gitUrl }}:{{ minVersion }}"
          - title: "Override Section"
            language: swift
            content: "Base Content"
        features:
          timeouts:
            - GET /movie/{movieId}
      outputFolder: readme-config
  pagination:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        custom-pager-name: MyPager
      outputFolder: custom-pager
    - customConfig:
        custom-pager-name: MyPager
        include-exception-handler: true
      outputFolder: custom-pager-with-exception-handler
  single-url-environment-default:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        environmentEnumName: MyCustomEnvironment
      outputFolder: with-custom-config

allowedFailures:
  - accept-header
  - any-auth
  - api-wide-base-path
  - audiences
  - auth-environment-variables
  - circular-references
  - circular-references-advanced
  - client-side-params:with-custom-config
  - client-side-params:no-custom-config
  - cross-package-type-names
  - enum
  - errors
  - examples:no-custom-config
  - examples:readme-config
  - exhaustive
  - extra-properties
  - file-upload-openapi
  - idempotency-headers
  - imdb
  - inferred-auth-explicit
  - inferred-auth-implicit
  - inferred-auth-implicit-no-expiry
  - literal
  - mixed-case
  - mixed-file-directory
  - multi-url-environment
  - multi-url-environment-no-default
  - nullable
  - nullable-optional
  - oauth-client-credentials-custom
  - oauth-client-credentials-with-variables
  - pagination:no-custom-config
  - pagination:custom-pager
  - pagination:custom-pager-with-exception-handler
  - path-parameters
  - plain-text
  - property-access
  - query-parameters
  - query-parameters-openapi
  - query-parameters-openapi-as-objects
  - request-parameters
  - required-nullable
  - reserved-keywords
  - response-property
  - simple-fhir
  - streaming
  - streaming-parameter
  - trace
  - undiscriminated-unions
  - unions
  - variables
  - websocket-inferred-auth
  - file-upload
