irVersion: v61
displayName: Java SDK
changelogLocation: ../../generators/java/sdk/versions.yml
image: fernapi/fern-java-sdk

buildScripts:
  compileScript:
    commands:
      - ./gradlew compileJava

publish:
  workingDirectory: generators/java
  preBuildCommands:
    - ./gradlew :sdk:distTar
    - pnpm --filter @fern-api/java-sdk dist:cli
  docker:
    file: ./generators/java/sdk/Dockerfile
    image: fernapi/fern-java-sdk
    context: .
test:
  docker:
    image: fernapi/fern-java-sdk:latest
    context: .
    command:
      - cd generators/java
      - ./gradlew :sdk:distTar
      - cd ../../
      - pnpm --filter @fern-api/java-sdk dist:cli
      - docker build -f generators/java/sdk/Dockerfile -t fernapi/fern-java-sdk:latest .
  local:
    workingDirectory: generators/java
    buildCommand:
      - ./gradlew :sdk:distTar
      - chmod +x install-gradle.sh && ./install-gradle.sh
      - cd sdk
      - tar -xvf build/distributions/sdk.tar -C .
    runCommand: cd sdk/sdk && java -cp sdk.jar:lib/* com.fern.java.client.Cli {CONFIG_PATH}
    env: {}

language: java
generatorType: SDK
defaultOutputMode: github
fixtures:
  exhaustive:
    - customConfig:
        enable-wire-tests: true
      outputFolder: no-custom-config
    - customConfig:
        package-layout: flat
        use-default-request-parameter-values: true
      outputFolder: flat-package-layout
    - customConfig:
        inline-path-parameters: true
        custom-dependencies:
          - "implementation jakarta.websocket:jakarta.websocket-api:2.1.0"
      outputFolder: custom-dependency
    - customConfig:
        inline-path-parameters: true
        json-include: non-empty
      outputFolder: json-include-non-empty
    - customConfig:
        inline-path-parameters: true
        enable-forward-compatible-enums: true
      outputFolder: forward-compatible-enums
    - customConfig:
        inline-path-parameters: true
        base-api-exception-class-name: CustomApiException
        base-exception-class-name: CustomException
      outputFolder: custom-error-names
    - customConfig:
        inline-path-parameters: true
        client-class-name: Best
      outputFolder: custom-client-class-name
      readmeConfig:
        exampleStyle: minimal
    - customConfig:
        inline-path-parameters: true
        package-prefix: com.fern.sdk
      outputMode: local_files
      outputFolder: local-files
    - customConfig:
        inline-path-parameters: true
        enable-public-constructors: true
      outputFolder: enable-public-constructors
    # Wire tests moved to main module to fix compilation
    # - customConfig:
    #     inline-path-parameters: true
    #     enable-wire-tests: true
    #   outputFolder: wire-tests
    - customConfig:
        publish-to: central
      outputFolder: publish-to
    - publishConfig:
        type: maven
        coordinate: com.fern:exhaustive
        registryUrl: "definitelyMavenCentral"
        signature:
          keyId: "test_kid"
          password: "test_password"
          secretKey: "test_secretkey"
      publishMetadata:
        package_description: My very good and lengthy description
        publisher_email: "me@gmail.com"
        publisher_name: "Fern"
        reference_url: "https://buildwithfern.com"
      outputFolder: signed_publish
    - publishConfig:
        type: maven
        coordinate: com.fern:exhaustive
        registryUrl: "definitelyMavenCentral"
      publishMetadata:
        package_description: SDK with custom license
        publisher_email: "developers@example.com"
        publisher_name: "Example Corp"
      license:
        custom: LICENSE
      outputFolder: custom-license
  java-inline-types:
    - customConfig:
        enable-inline-types: true
        wrapped-aliases: true
      outputFolder: inline
    - customConfig:
        enable-inline-types: false
        wrapped-aliases: true
      outputFolder: no-inline
    - customConfig:
        enable-inline-types: true
        wrapped-aliases: false
      outputFolder: no-wrapped-aliases
    - customConfig:
        enable-inline-types: true
        wrapped-aliases: false
        enable-forward-compatible-enums: true
      outputFolder: enable-forward-compatible-enums
  imdb:
    - customConfig:
        disable-required-property-builder-checks: true
      outputFolder: disable-required-property-builder-checks
    - customConfig:
        package-layout: flat
      outputFolder: flat-package-layout
  java-custom-package-prefix:
    - customConfig:
        package-prefix: "com.customprefix"
      outputFolder: java-custom-package-prefix
  java-single-property-endpoint:
    - outputFolder: java-single-property-endpoint
  java-pagination-deep-cursor-path:
    - outputFolder: java-pagination-deep-cursor-path
    - customConfig:
        enable-wire-tests: true
      outputFolder: wire-tests
  pagination:
    - customConfig:
        enable-wire-tests: true
      outputFolder: default
  unions:
    - customConfig:
        enable-wire-tests: true
      outputFolder: default
  accept-header:
    - outputFolder: accept-header
  client-side-params:
    - customConfig:
        use-default-request-parameter-values: true
        enable-wire-tests: true
      outputFolder: default
  file-upload:
    - customConfig:
        wrapped-aliases: true
      outputFolder: wrapped-aliases
    - customConfig:
        inline-file-properties: true
        inline-path-parameters: true
      outputFolder: inline-file-properties
    - outputFolder: no-custom-config
  examples:
    - customConfig:
        enable-wire-tests: true
      outputFolder: default
    - customConfig:
        inline-file-properties: true
        inline-path-parameters: true
      outputFolder: inline-file-properties
    - outputFolder: no-custom-config
    - customConfig:
        custom-readme-sections:
          - title: "Generator Invocation Custom Section"
            content: "Generator Invocation Custom Content for {{ group }}:{{ artifact }}:{{ version }}"
          - title: "Override Section"
            content: "Override Content"
      readmeConfig:
        apiName: "CustomName"
        disabledSections:
          - "contributing"
        bannerLink: https://www.fernapi.com
        apiReferenceLink: https://www.docs.fernapi.com
        defaultEndpoint: POST /movie
        exampleStyle: minimal
        customSections:
          - title: "Custom Section"
            language: java
            content: |
              This is a custom section. Latest package info is {{ group }}:{{ artifact }}:{{ version }}
          - title: "Override Section"
            language: java
            content: "Base Content"
        features:
          timeouts:
            - GET /movie/{movieId}
            - method: POST
              path: /movie
      outputFolder: readme-config
  nullable:
    - customConfig:
        wrapped-aliases: true
      outputFolder: wrapped-aliases
    - outputFolder: no-custom-config
  java-nullable-named-request-types:
    - outputFolder: custom-config
      customConfig:
        respect-nullable-schemas: true
  enum:
    - customConfig:
        enable-forward-compatible-enums: true
      outputFolder: forward-compatible-enums
    - outputFolder: no-custom-config
  version:
    - customConfig:
        enable-forward-compatible-enums: true
      outputFolder: forward-compatible-enums
    - outputFolder: no-custom-config
  java-builder-extension:
    - customConfig:
        client-class-name: BaseClient
      outputFolder: base-client
    - customConfig:
        client-class-name: BaseClient
        enable-extensible-builders: true
      outputFolder: extensible-builders
  basic-auth:
    - customConfig:
        enable-wire-tests: true
      outputFolder: basic-auth
  oauth-client-credentials:
    - customConfig:
        enable-wire-tests: true
      outputFolder: oauth-client-credentials
  custom-auth:
    - customConfig:
        enable-wire-tests: true
      outputFolder: custom-auth
  nullable-optional:
    - customConfig:
        use-nullable-annotation: true
      outputFolder: with-nullable-annotation
    - customConfig:
        use-nullable-annotation: false
      outputFolder: legacy
    - customConfig:
        collapse-optional-nullable: true
      outputFolder: collapse-optional-nullable
scripts:
  - docker: fernapi/java-seed
    commands:
      - source ~/.bash_profile && jenv shell 1.8 && source ~/.bash_profile && ./gradlew compileJava spotlessCheck
allowedFailures:
  - alias-extends
  - bytes-download
  - bytes-upload
  - enum:forward-compatible-enums
  - enum:no-custom-config
  - errors
  - examples:default
  - examples:inline-file-properties
  - examples:no-custom-config
  - examples:readme-config
  - exhaustive:local-files
  - exhaustive:publish-to
  - exhaustive:signed_publish
  - extends
  - inferred-auth-explicit
  - inferred-auth-implicit
  - inferred-auth-implicit-no-expiry
  - java-inline-types:no-wrapped-aliases
  - literal
  - nullable-optional:with-nullable-annotation
  - nullable-optional:collapse-optional-nullable
  - oauth-client-credentials-custom
  - oauth-client-credentials-with-variables
  - query-parameters-openapi
  - query-parameters-openapi-as-objects
  - request-parameters
  - streaming-parameter
  - trace
  - websocket-inferred-auth

  # Snippet failures; many of these failures are due to the fact that a
  # required list of query parameters is not actually required by the builder.
  - any-auth
  - extra-properties
  - java-inline-types:inline
  - java-inline-types:enable-forward-compatible-enums
  - nullable:wrapped-aliases
  - nullable:no-custom-config
  - oauth-client-credentials
  - oauth-client-credentials-default
  - oauth-client-credentials-environment-variables
  - oauth-client-credentials-nested-root
  - pagination-custom
  - query-parameters
  - streaming

  - java-pagination-deep-cursor-path:wire-tests

  # Bug with how java-sdk creates nightly balanced files
  - java-pagination-deep-cursor-path

  # File upload dynamic snippets have compilation errors due to missing file parameters
  # These failures are from pre-existing broken dynamic snippet generation
  - file-upload:no-custom-config
  - file-upload:wrapped-aliases
  - file-upload:inline-file-properties
  - file-upload-openapi
