/**
 * This file was auto-generated by Fern from our API Definition.
 */
package com.seed.websocketAuth.core;

import com.seed.websocketAuth.resources.auth.AuthClient;
import com.seed.websocketAuth.resources.auth.requests.GetTokenRequest;
import com.seed.websocketAuth.resources.auth.types.TokenResponse;
import java.util.HashMap;
import java.util.Map;
import java.util.function.Supplier;

public final class InferredAuthTokenSupplier implements Supplier<Map<String, String>> {
    private final String xApiKey;

    private final String clientId;

    private final String clientSecret;

    private final String scope;

    private final AuthClient authClient;

    private Map<String, String> cachedHeaders;

    public InferredAuthTokenSupplier(
            String xApiKey, String clientId, String clientSecret, String scope, AuthClient authClient) {
        this.xApiKey = xApiKey;
        this.clientId = clientId;
        this.clientSecret = clientSecret;
        this.scope = scope;
        this.authClient = authClient;
    }

    private TokenResponse fetchToken() {
        GetTokenRequest getTokenRequest = GetTokenRequest.builder()
                .xApiKey(xApiKey)
                .clientId(clientId)
                .clientSecret(clientSecret)
                .scope(scope)
                .build();
        return authClient.getTokenWithClientCredentials(getTokenRequest);
    }

    @java.lang.Override
    public Map<String, String> get() {
        if (cachedHeaders == null) {
            TokenResponse tokenResponse = fetchToken();
            Map<String, String> headers = new HashMap<>();
            headers.put("Authorization", "Bearer " + tokenResponse.getAccessToken());
            this.cachedHeaders = headers;
        }
        return cachedHeaders;
    }
}
