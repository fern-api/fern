/**
 * This file was auto-generated by Fern from our API Definition.
 */
package com.seed.endpointSecurityAuth.core;

import java.nio.charset.StandardCharsets;
import java.util.Base64;
import java.util.HashMap;
import java.util.Map;
import java.util.function.Supplier;

/**
 * Auth provider for Basic authentication.
 */
public final class BasicAuthProvider implements AuthProvider {
    public static final String AUTH_SCHEME = "Basic";

    public static final String AUTH_CONFIG_ERROR_MESSAGE =
            "Please provide username and password when initializing the client";

    private final Supplier<String> usernameSupplier;

    private final Supplier<String> passwordSupplier;

    public BasicAuthProvider(Supplier<String> usernameSupplier, Supplier<String> passwordSupplier) {
        this.usernameSupplier = usernameSupplier;
        this.passwordSupplier = passwordSupplier;
    }

    @Override
    public Map<String, String> getAuthHeaders(EndpointMetadata endpointMetadata) {
        String username = usernameSupplier.get();
        String password = passwordSupplier.get();
        if (username == null || password == null) {
            throw new RuntimeException(AUTH_CONFIG_ERROR_MESSAGE);
        }
        String credentials = username + ":" + password;
        String encoded = Base64.getEncoder().encodeToString(credentials.getBytes(StandardCharsets.UTF_8));
        Map<String, String> headers = new HashMap<>();
        headers.put("Authorization", "Basic " + encoded);
        return headers;
    }

    /**
     * Checks if this provider can be created with the given suppliers.
     */
    public static boolean canCreate(Supplier<String> usernameSupplier, Supplier<String> passwordSupplier) {
        return (usernameSupplier != null || System.getenv("MY_USERNAME") != null)
                && (passwordSupplier != null || System.getenv("MY_PASSWORD") != null);
    }
}
