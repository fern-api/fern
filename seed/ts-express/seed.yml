irVersion: v58
displayName: TypeScript Express
changelogLocation: ../../generators/typescript/express/versions.yml
image: fernapi/fern-typescript-express

buildScripts:
  installScript:
    commands:
      - yarn install
  compileScript:
    commands:
      - yarn build

publish:
  versionSubstitution: $VERSION
  command:
    - pnpm --filter @fern-typescript/express-generator-cli dockerTagVersion $VERSION
    - docker push fernapi/fern-typescript-express:$VERSION
test:
  docker:
    image: fernapi/fern-typescript-express:local
    command: pnpm --filter @fern-typescript/express-generator-cli dockerTagLocal
  local:
    workingDirectory: generators/typescript
    buildCommand:
      - pnpm --filter @fern-typescript/express-generator-cli compile
      - pnpm --filter @fern-typescript/express-generator-cli build
    runCommand: node --enable-source-maps express/cli/dist/cli.cjs {CONFIG_PATH}
    env:
      NODE_ENV: test

language: typescript
generatorType: Server
defaultOutputMode: local_files
defaultCustomConfig:
  outputSourceFiles: true
fixtures:
  ts-express-casing:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        noSerdeLayer: true
      outputFolder: no-serde-layer
  trace:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        noSerdeLayer: true
      outputFolder: no-zurg-trace
  imdb:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        outputSourceFiles: false
      outputFolder: output-compiled
    - customConfig:
        skipRequestValidation: true
      outputFolder: skip-request-validation
    - customConfig:
        skipResponseValidation: true
      outputFolder: skip-response-validation
    - customConfig:
        requestValidationStatusCode: 400
      outputFolder: validation-status-code
  exhaustive:
    - customConfig:
        packagePath: src/test-packagePath
      outputFolder: test-package-path
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        retainOriginalCasing: true
      outputFolder: retain-original-casing
    - customConfig:
        noOptionalProperties: true
      outputFolder: no-optional-properties
    - customConfig:
        allowExtraFields: true
      outputFolder: allow-extra-fields
    - customConfig:
        doNotHandleUnrecognizedErrors: true
        includeUtilsOnUnionMembers: true
        includeOtherInUnionTypes: true
      outputFolder: union-utils
  mixed-case:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        retainOriginalCasing: true
      outputFolder: retain-original-casing
allowedFailures:
  - accept-header
  - alias
  - alias-extends
  - any-auth
  - api-wide-base-path
  - audiences
  - auth-environment-variables
  - basic-auth
  - basic-auth-environment-variables
  - bearer-token-environment-variable
  - bytes-download
  - bytes-upload
  - circular-references
  - circular-references-advanced
  - client-side-params
  - content-type
  - cross-package-type-names
  - custom-auth
  - empty-clients
  - enum
  - error-property
  - errors
  - examples
  - exhaustive:allow-extra-fields
  - exhaustive:no-custom-config
  - exhaustive:no-optional-properties
  - exhaustive:retain-original-casing
  - exhaustive:test-package-path
  - exhaustive:union-utils
  - extends
  - extra-properties
  - file-download
  - file-upload
  - folders
  - http-head
  - idempotency-headers
  - imdb:no-custom-config
  - imdb:output-compiled
  - imdb:skip-request-validation
  - imdb:skip-response-validation
  - imdb:validation-status-code
  - inferred-auth-explicit
  - inferred-auth-implicit
  - inferred-auth-implicit-no-expiry
  - license
  - literal
  - literals-unions
  - mixed-case:no-custom-config
  - mixed-case:retain-original-casing
  - mixed-file-directory
  - multi-line-docs
  - multi-url-environment
  - multi-url-environment-no-default
  - multiple-request-bodies
  - no-environment
  - nullable
  - nullable-optional
  - oauth-client-credentials
  - oauth-client-credentials-custom
  - oauth-client-credentials-default
  - oauth-client-credentials-environment-variables
  - oauth-client-credentials-nested-root
  - oauth-client-credentials-with-variables
  - object
  - objects-with-imports
  - optional
  - package-yml
  - pagination
  - pagination-custom
  - path-parameters
  - plain-text
  - property-access
  - public-object
  - query-parameters
  - query-parameters-openapi
  - query-parameters-openapi-as-objects
  - request-parameters
  - reserved-keywords
  - response-property
  - server-sent-event-examples
  - server-sent-events
  - simple-api
  - simple-fhir
  - single-url-environment-default
  - single-url-environment-no-default
  - streaming
  - streaming-parameter
  - trace:no-custom-config
  - trace:no-zurg-trace
  - ts-express-casing:no-custom-config
  - ts-express-casing:no-serde-layer
  - ts-inline-types
  - undiscriminated-unions
  - unions
  - unknown
  - validation
  - variables
  - version
  - version-no-default
  - websocket
  - websocket-bearer-auth
  - websocket-inferred-auth
