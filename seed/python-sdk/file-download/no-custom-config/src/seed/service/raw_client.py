# This file was auto-generated by Fern from our API Definition.

from ..core.client_wrapper import SyncClientWrapper
import typing
from ..core.request_options import RequestOptions
from ..core.http_response import HttpResponseStreamManager
from ..core.http_response import HttpResponse
from json.decoder import JSONDecodeError
from ..core.api_error import ApiError
from ..core.client_wrapper import AsyncClientWrapper
from ..core.http_response import AsyncHttpResponseStreamManager
from ..core.http_response import AsyncHttpResponse


class RawServiceClient:
    def __init__(self, *, client_wrapper: SyncClientWrapper):
        self._client_wrapper = client_wrapper

    def download_file(
        self, *, request_options: typing.Optional[RequestOptions] = None
    ) -> HttpResponseStreamManager[typing.Iterator[bytes]]:
        """
        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration. You can pass in configuration such as `chunk_size`, and more to customize the request and response.

        Returns
        -------
        HttpResponseStreamManager[typing.Iterator[bytes]]
        """

        def _stream_func() -> HttpResponse[typing.Iterator[typing.Iterator[bytes]]]:
            with self._client_wrapper.httpx_client.stream(
                method="POST",
                request_options=request_options,
            ) as _response:
                try:
                    if 200 <= _response.status_code < 300:
                        _chunk_size = request_options.get("chunk_size", None) if request_options is not None else None
                        return HttpResponse(
                            response=_response, data=(_chunk for _chunk in _response.iter_bytes(chunk_size=_chunk_size))
                        )
                    _response.read()
                    _response_json = _response.json()
                except JSONDecodeError:
                    raise ApiError(status_code=_response.status_code, body=_response.text)
                raise ApiError(status_code=_response.status_code, body=_response_json)

        return HttpResponseStreamManager(stream_func=_stream_func)


class AsyncRawServiceClient:
    def __init__(self, *, client_wrapper: AsyncClientWrapper):
        self._client_wrapper = client_wrapper

    async def download_file(
        self, *, request_options: typing.Optional[RequestOptions] = None
    ) -> AsyncHttpResponseStreamManager[typing.AsyncIterator[bytes]]:
        """
        Parameters
        ----------
        request_options : typing.Optional[RequestOptions]
            Request-specific configuration. You can pass in configuration such as `chunk_size`, and more to customize the request and response.

        Returns
        -------
        AsyncHttpResponseStreamManager[typing.AsyncIterator[bytes]]
        """

        async def _stream_func() -> AsyncHttpResponse[typing.AsyncIterator[typing.AsyncIterator[bytes]]]:
            async with self._client_wrapper.httpx_client.stream(
                method="POST",
                request_options=request_options,
            ) as _response:
                try:
                    if 200 <= _response.status_code < 300:
                        _chunk_size = request_options.get("chunk_size", None) if request_options is not None else None
                        return AsyncHttpResponse(
                            response=_response,
                            data=(_chunk async for _chunk in _response.aiter_bytes(chunk_size=_chunk_size)),
                        )
                    await _response.aread()
                    _response_json = _response.json()
                except JSONDecodeError:
                    raise ApiError(status_code=_response.status_code, body=_response.text)
                raise ApiError(status_code=_response.status_code, body=_response_json)

        return AsyncHttpResponseStreamManager(stream_func=_stream_func)
