displayName: C# SDK
irVersion: v62
image: fernapi/fern-csharp-sdk
changelogLocation: ../../generators/csharp/sdk/versions.yml

buildScripts:
  preInstallScript:
    commands:
      - dotnet tool restore
  compileScript:
    commands:
      - |
        solution_file="$(find . -maxdepth 4 -name '*.slnx' | head -n 1)"
        if [ -z "$solution_file" ]; then
          echo "ERROR: No .slnx file found"
          exit 1
        fi
        dotnet build "$solution_file" -c Release
  testScript:
    commands:
      - |
        solution_file="$(find . -maxdepth 4 -name '*.slnx' | head -n 1)"
        if [ -z "$solution_file" ]; then
          echo "ERROR: No .slnx file found"
          exit 1
        fi
        dotnet test "$solution_file"

publish:
  preBuildCommands:
    - pnpm turbo run dist:cli --filter @fern-api/fern-csharp-sdk 
  docker:
    file: ./generators/csharp/sdk/Dockerfile
    image: fernapi/fern-csharp-sdk
    context: .
test:
  docker:
    image: fernapi/fern-csharp-sdk:latest
    command: pnpm turbo run dockerTagLatest --filter @fern-api/fern-csharp-sdk
  podman:
    image: fernapi/fern-csharp-sdk:latest
    command: pnpm turbo run podmanTagLatest --filter @fern-api/fern-csharp-sdk
  local:
    workingDirectory: generators/csharp
    buildCommand:
      - pnpm turbo run dist:cli --filter @fern-api/fern-csharp-sdk
    runCommand: node --enable-source-maps sdk/dist/cli.cjs {CONFIG_PATH}

language: csharp
generatorType: SDK
defaultOutputMode: github
defaultCustomConfig: {}
scripts:
  - image: fernapi/csharp-seed
    commands:
      build:
        - |
          # Check for .NET 10
          # if you are getting an error from this and using docker, run `docker pull fernapi/csharp-seed:latest`
          # otherwise install .NET 10 
          command -v dotnet >/dev/null 2>&1 && ver=$(dotnet --version) && major=$(echo "$ver" | cut -d. -f1) && [ "$major" -ge 10 ] || { echo "ERROR: .NET SDK 10+ required (found ${ver:-not found})"; false; }
          
          # Find the solution file
          solution_file="$(find . -maxdepth 4 -name '*.slnx' | head -n 1)"
          if [ -z "$solution_file" ]; then
            echo "ERROR: No .slnx file found"
            exit 1
          fi
          
          dotnet build "$solution_file" -c Release
          dotnet build src/*DynamicSnippets/*.csproj -c Release
      test:
        - |
          # Find the solution file
          solution_file="$(find . -maxdepth 4 -name '*.slnx' | head -n 1)"
          if [ -z "$solution_file" ]; then
            echo "ERROR: No .slnx file found"
            exit 1
          fi
          
          dotnet test "$solution_file" --no-restore --no-build -c Release

fixtures:
  simple-api:
    - outputFolder: no-custom-config
      customConfig: null
    - outputFolder: custom-output-path
      customConfig:
        output-path: custom-src
    - outputFolder: custom-output-path-object
      customConfig:
        output-path:
          library: lib/SeedApi
          test: test/SeedApi.Test
          solution: .
          other: lib/SeedApi
  literal:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        experimental-readonly-constants: true
      outputFolder: readonly-constants
  pagination:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        custom-pager-name: MyPager
      outputFolder: custom-pager
    - customConfig:
        custom-pager-name: MyPager
        include-exception-handler: true
      outputFolder: custom-pager-with-exception-handler
  examples:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        custom-readme-sections:
          - title: "Override Section"
            content: "Override Content"
          - title: "Generator Invocation Custom Section"
            content: "Generator Invocation Custom Content for {{ packageName }}"
      readmeConfig:
        apiName: "CustomName"
        disabledSections:
          - "contributing"
        bannerLink: https://www.fernapi.com
        apiReferenceLink: https://www.docs.fernapi.com
        defaultEndpoint: POST /movie
        customSections:
          - title: "Base Readme Custom Section"
            language: csharp
            content: "Base Readme Custom Content for {{ packageName }}"
          - title: "Override Section"
            language: csharp
            content: "Base Content"
        features:
          timeouts:
            - GET /movie/{movieId}
            - method: POST
              path: /movie
      outputFolder: readme-config
  imdb:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        extra-dependencies:
          Moq: 4.20.70
          Moq.Contrib.HttpClient: "1.4.0"
      outputFolder: extra-dependencies
    - customConfig:
        base-api-exception-class-name: CustomApiException
        base-exception-class-name: CustomException
      outputFolder: exception-class-names
    - customConfig:
        client-class-name: BaseClient
        exported-client-class-name: CustomClient
      outputFolder: exported-client-class-name
    - customConfig:
        include-exception-handler: true
      outputFolder: include-exception-handler
  multi-url-environment:
    - customConfig:
        pascal-case-environments: false
      outputFolder: no-pascal-case-environments
    - customConfig:
        environment-class-name: CustomEnvironment
      outputFolder: environment-class-name
  exhaustive:
    - customConfig:
        explicit-namespaces: true
      outputFolder: explicit-namespaces
    - customConfig:
        root-namespace-for-core-classes: false
      outputFolder: no-root-namespace-for-core-classes
    - customConfig:
        generate-error-types: false
      outputFolder: no-generate-error-types
    - customConfig:
        include-exception-handler: true
      outputFolder: include-exception-handler
  optional:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        simplify-object-dictionaries: true
      outputFolder: simplify-object-dictionaries
  path-parameters:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        inline-path-parameters: false
      outputFolder: no-inline-path-parameters
  csharp-grpc-proto-exhaustive:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        package-id: Seed.Client
      outputFolder: package-id
    - customConfig:
        read-only-memory-types:
          - float
      outputFolder: read-only-memory
    - customConfig:
        include-exception-handler: true
      outputFolder: include-exception-handler
  oauth-client-credentials:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        include-exception-handler: true
      outputFolder: include-exception-handler
  enum:
    - customConfig: null
      outputFolder: forward-compatible-enums
    - customConfig:
        enable-forward-compatible-enums: false
      outputFolder: plain-enums
  license:
    - license:
        type: basic
        id: MIT
      outputFolder: mit-license
    - license:
        type: custom
        filename: "../../LICENSE"
      outputFolder: custom-license
  unions:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        use-discriminated-unions: false
      outputFolder: no-discriminated-unions
  extra-properties:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        additional-properties: false
      outputFolder: no-additional-properties
  csharp-namespace-collision:
    - customConfig:
        experimental-fully-qualified-namespaces: true
        experimental-dotnet-format: true
      outputFolder: fully-qualified-namespaces
  csharp-system-collision:
    - customConfig:
        client-class-name: System
      outputFolder: system-client
  websocket: 
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        experimental-readonly-constants: true
        experimental-enable-websockets: true
      outputFolder: with-websockets
  csharp-xml-entities:
    - customConfig: null
      outputFolder: no-custom-config
  version:
    - customConfig: null
      outputFolder: no-custom-config
allowedFailures:
  - any-auth
  - csharp-namespace-collision:fully-qualified-namespaces
  - enum:forward-compatible-enums
  - enum:plain-enums
  - examples:no-custom-config
  - examples:readme-config
  - extra-properties:no-additional-properties
  - extra-properties:no-custom-config
  - literal:no-custom-config
  - literal:readonly-constants
  - oauth-client-credentials-custom
  - oauth-client-credentials-environment-variables
  - oauth-client-credentials-mandatory-auth
  - oauth-client-credentials-nested-root
  - oauth-client-credentials-with-variables
  - oauth-client-credentials:include-exception-handler
  - oauth-client-credentials:no-custom-config
  - package-yml
  - simple-fhir
  - trace
  - undiscriminated-unions
  - unions-with-local-date
  - unions:no-custom-config
  - url-form-encoded
