irVersion: v61
displayName: Rust SDK
image: fernapi/fern-rust-sdk
changelogLocation: ../../generators/rust/sdk/versions.yml

buildScripts:
  compileScript:
    commands:
      - cargo build --all-features
  testScript:
    commands:
      - cargo test

publish:
  workingDirectory: generators/rust
  preBuildCommands:
    - pnpm turbo run dist:cli --filter @fern-api/rust-sdk
  docker:
    file: ./generators/rust/sdk/Dockerfile
    image: fernapi/fern-rust-sdk
    context: .

test:
  docker:
    image: fernapi/fern-rust-sdk:latest
    command: pnpm turbo run dist:cli --filter @fern-api/rust-sdk && docker build -f ./generators/rust/sdk/Dockerfile -t fernapi/fern-rust-sdk:latest .
  local:
    workingDirectory: generators/rust
    buildCommand:
      - pnpm turbo run dist:cli --filter @fern-api/rust-sdk
    runCommand: node --enable-source-maps ./sdk/dist/cli.cjs {CONFIG_PATH}

language: rust
generatorType: SDK
defaultOutputMode: github

customFixtureConfig:
  customConfig:
    packageName: test_sdk
    packageVersion: "0.1.0"

fixtures:
  simple:
    - customConfig: null
      outputFolder: basic
    - customConfig:
        crateName: custom_simple_sdk
        crateVersion: "1.2.0"
        clientClassName: CustomSimpleClient
        enableWireTests: true
      outputFolder: basic-custom-config
  imdb:
    - customConfig:
        clientName: ImdbClient
      outputFolder: imdb
    - customConfig:
        crateName: custom_imdb_sdk
        crateVersion: "2.1.0"
        clientClassName: CustomImdbClient
        extraDependencies:
          serde_derive: "1.0"
          tokio-util: "0.7"
        enableWireTests: true
      outputFolder: imdb-custom-config
    - customConfig:
        clientName: ImdbClient
        features:
          experimental: ["reqwest/blocking", "tokio/process"]
          advanced: ["sse"]
        defaultFeatures: ["experimental"]
      outputFolder: imdb-custom-features
  single-url-environment-default:
    - customConfig: null
      outputFolder: basic
    - customConfig:
        environmentEnumName: CustomApiEnvironment
        crateName: environment_test_sdk
        crateVersion: "0.2.0"
      outputFolder: custom-environment
    - customConfig:
        environmentEnumName: MyCustomEnvironment
        customReadmeSections:
          - title: "Custom Installation"
            content: "Add this line to your Cargo.toml:\n```toml\n[dependencies]\ncustom_sdk = \"1.0.0\"\n```"
          - title: "Advanced Usage"
            content: "For advanced users, you can configure custom retry policies and timeouts."
        crateName: full_custom_sdk
        crateVersion: "1.0.0"
        enableWireTests: true
      outputFolder: full-custom
  examples:
    - customConfig: null
      outputFolder: no-custom-config
    - customConfig:
        enableWireTests: true
        customReadmeSections:
          - title: "Override Section"
            content: "Override Content"
          - title: "Generator Invocation Custom Section"
            content: "Generator Invocation Custom Content for {{ packageName }}:{{ version }}"
      readmeConfig:
        apiName: "CustomName"
        disabledSections:
          - apiReference
        bannerLink: https://www.fernapi.com
        apiReferenceLink: https://www.docs.fernapi.com
        defaultEndpoint: POST /movie
        customSections:
          - title: "Base Readme Custom Section"
            language: rust
            content: "Base Readme Custom Content for {{ packageName }}:{{ version }}"
          - title: "Override Section"
            language: rust
            content: "Base Content"
        features:
          timeouts:
            - GET /movie/{movieId}
      outputFolder: readme-config
  server-sent-event-examples:
    - customConfig:
        enableWireTests: true
        packageName: sse_examples
        packageVersion: "0.1.0"
      outputFolder: with-wire-tests
  server-sent-events:
    - customConfig:
        enableWireTests: true
        packageName: sse_events
        packageVersion: "0.1.0"
      outputFolder: with-wire-tests
