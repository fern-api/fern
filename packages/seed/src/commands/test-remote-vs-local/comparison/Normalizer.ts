import { NormalizationRule } from "./types";

export class Normalizer {
    private rules: NormalizationRule[];

    constructor(rules: NormalizationRule[] = []) {
        this.rules = rules;
    }

    public normalize(content: string): string {
        let normalized = content;

        for (const rule of this.rules) {
            const regex = new RegExp(rule.pattern, "g");
            normalized = normalized.replace(regex, rule.replace);
        }

        return normalized;
    }

    public static getDefaultRules(): NormalizationRule[] {
        return [
            {
                pattern: "Generated by Fern \\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}",
                replace: "Generated by Fern YYYY-MM-DDTHH:MM:SS"
            },
            {
                pattern: "Generated on \\d{4}-\\d{2}-\\d{2}",
                replace: "Generated on YYYY-MM-DD"
            },
            {
                pattern: "timestamp: \\d+",
                replace: "timestamp: TIMESTAMP"
            },
            {
                pattern: "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d+Z",
                replace: "YYYY-MM-DDTHH:MM:SS.sssZ"
            }
        ];
    }
}
