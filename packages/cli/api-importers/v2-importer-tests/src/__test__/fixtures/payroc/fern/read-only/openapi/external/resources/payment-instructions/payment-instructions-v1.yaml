openapi: 3.0.1
info:
  title: Transaction API
  version: '1'
  termsOfService: https://www.payroc.com/terms
  contact:
    name: Payroc Helpdesk
    url: https://www.payroc.com/help
    email: helpdesk@payroc.com
servers:
  - url: https://api.payroc.com/v1
    description: Production
  - url: https://api.uat.payroc.com/v1
    description: UAT
tags:
- name: Payment instructions

paths:
  /payment-instructions/{paymentInstructionId}:
    get:
      tags:
        - Payment instructions
      summary: Retrieve payment instruction
      operationId: getPaymentInstruction
      description: Retrieve the current status of a specific payment instruction.
      parameters:
        - $ref: './parameters-v1.yaml#/components/parameters/paymentInstructionId'
      responses:
        '200':
          description: Successful request. Returns the current status of the requested payment instruction.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/paymentInstruction'
              examples:
                paymentInstruction:
                  $ref: './example-responses-v1.yaml#/components/examples/paymentInstruction'
        '400':
          $ref: ../../../common/responses/errors/400-v1.yaml#/components/responses/400
        '401':
          $ref: ../../../common/responses/errors/401-v1.yaml#/components/responses/401
        '403':
          $ref: ../../../common/responses/errors/403-v1.yaml#/components/responses/403
        '404':
          $ref: ../../../common/responses/errors/404-v1.yaml#/components/responses/404
        '406':
          $ref: ../../../common/responses/errors/406-v1.yaml#/components/responses/406
        '500':
          $ref: ../../../common/responses/errors/500-v1.yaml#/components/responses/500
  /devices/{serialNumber}/payment-instructions:
    post:
      tags:
        - Payment instructions
      summary: Submit payment instruction
      operationId: sendPaymentInstruction
      description: Submit an instruction request to initiate a sale on a payment device.
      parameters:
        - $ref: './parameters-v1.yaml#/components/parameters/serialNumber'
        - $ref: ../../../common/parameters/idempotency-key-v1.yaml#/components/parameters/idempotencyKey
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/paymentInstructionRequest'
            examples:
              paymentInstructionRequest:
                $ref: './example-requests-v1.yaml#/components/examples/paymentInstructionRequest'
      responses:
        '202':
          description: Successful request. We accepted the payment instruction to process.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/paymentInstruction'
              examples:
                paymentInstruction:
                  $ref: './example-responses-v1.yaml#/components/examples/paymentInstructionInProgress'
        '400':
          description: Validation error
          content:
            application/problem+json:
              schema:
                $ref: '../../../common/responses/errors/400-v1.yaml#/components/schemas/400'
              examples:
                validationError:
                  $ref: '../../../common/responses/errors/400-v1.yaml#/components/examples/validatorError'
                idempotentKeyMissing:
                  $ref: '../../../common/responses/errors/400-v1.yaml#/components/examples/idempotentKeyMissing'
        '401':
          $ref: ../../../common/responses/errors/401-v1.yaml#/components/responses/401
        '403':
          $ref: ../../../common/responses/errors/403-v1.yaml#/components/responses/403
        '404':
          $ref: ../../../common/responses/errors/404-v1.yaml#/components/responses/404
        '406':
          $ref: ../../../common/responses/errors/406-v1.yaml#/components/responses/406
        '409':
          $ref: ../../../common/responses/errors/409-v1.yaml#/components/responses/409
        '415':
          $ref: ../../../common/responses/errors/415-v1.yaml#/components/responses/415
        '500':
          $ref: ../../../common/responses/errors/500-v1.yaml#/components/responses/500
    
components:
  schemas:
    paymentInstruction:
      required:
        - paymentInstructionId
        - status
      type: object
      allOf:
        - $ref: '../../../common/schemas/transaction/device-instruction-v1.yaml#/components/schemas/deviceInstruction'
        - type: object
          properties:
            paymentInstructionId:
              maxLength: 36
              minLength: 1
              type: string
              description: Unique identifier that our gateway assigned to the instruction.
              example: a37439165d134678a9100ebba3b29597
    paymentInstructionRequest:
      required:
        - order
        - processingTerminalId
      type: object
      description: Object that contains the instructions for initiating a payment on a physical device.
      properties:
        operator:
          maxLength: 50
          minLength: 0
          type: string
          description: Operator who initiated the request.
          example: Jane
        processingTerminalId:
          maxLength: 50
          minLength: 4
          type: string
          description: Unique identifier that we assigned to the terminal.
          example: '1234001'
        order:
          $ref: "#/components/schemas/paymentInstructionOrder"
        customer:
          $ref: '../../../common/schemas/transaction/customer-v1.yaml#/components/schemas/customer'
        ipAddress:
          $ref: "../../../common/schemas/common/ip-address-v1.yaml#/components/schemas/ipAddress"
        credentialOnFile:
          $ref: '../../../common/schemas/transaction/credential-on-file-v1.yaml#/components/schemas/credentialOnFile'
        customizationOptions:
          $ref: "../../../common/schemas/transaction/device-instruction-v1.yaml#/components/schemas/customizationOptions"
        autoCapture:
          type: boolean
          default: true
          description: |
            Indicates if we should automatically capture the payment amount.  

            - `true` - Run a sale and automatically capture the transaction.
            - `false`- Run a pre-authorization and capture the transaction later.  

            **Note:** If you send `false` and the terminal doesn't support pre-authorization, we set the transaction's status to pending. The merchant must capture the transaction to take payment from the customer.
          example: true
        processAsSale:
          type: boolean
          default: false
          description: |
            Indicates if we should immediately settle the sale transaction. The merchant cannot adjust the transaction if we immediately settle it.  
            **Note:** If the value for **processAsSale** is `true`, the gateway ignores the value in **autoCapture**.
          example: false
    paymentInstructionOrder:
      required:
        - amount
        - currency
        - orderId
      type: object
      description: Object that contains information about the payment.
      allOf:
        - $ref: '../../../common/schemas/transaction/order-v1.yaml#/components/schemas/order'
        - type: object
          properties:
            breakdown:
              $ref: '../../../common/schemas/transaction/order-v1.yaml#/components/schemas/breakdown'
