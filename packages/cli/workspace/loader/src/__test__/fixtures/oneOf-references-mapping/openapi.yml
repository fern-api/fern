openapi: 3.0.3
info:
  title: OneOf References Mapping Test API
  version: 1.0.0
  description: Test API for oneOf with discriminator mapping using references

servers:
  - url: https://api.example.com/v1

paths:
  /events:
    post:
      operationId: createEvent
      summary: Create an event
      description: Creates an event that can be of different types
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EventRequest"
      responses:
        "200":
          description: Event created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EventResponse"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    EventRequest:
      description: Request payload for creating events
      oneOf:
        - $ref: "#/components/schemas/UserEvent"
        - $ref: "#/components/schemas/SystemEvent"
        - $ref: "#/components/schemas/ErrorEvent"
      discriminator:
        propertyName: type
        mapping:
          user: "#/components/schemas/UserEvent"
          system: "#/components/schemas/SystemEvent"
          error: "#/components/schemas/ErrorEvent"

    UserEvent:
      type: object
      description: Event triggered by user actions
      required:
        - type
        - userId
        - action
      properties:
        type:
          type: string
          enum: [user]
          example: user
        userId:
          type: string
          description: ID of the user who triggered the event
          example: "user_123"
        action:
          type: string
          description: The action performed by the user
          example: "login"
        timestamp:
          type: string
          format: date-time
          description: When the event occurred
          example: "2023-12-01T12:00:00Z"

    SystemEvent:
      type: object
      description: Event generated by system processes
      required:
        - type
        - service
        - operation
      properties:
        type:
          type: string
          enum: [system]
          example: system
        service:
          type: string
          description: Name of the service that generated the event
          example: "auth-service"
        operation:
          type: string
          description: The system operation performed
          example: "cleanup"
        metadata:
          type: object
          description: Additional system metadata
          additionalProperties:
            type: string

    ErrorEvent:
      type: object
      description: Event representing an error condition
      required:
        - type
        - errorCode
        - message
      properties:
        type:
          type: string
          enum: [error]
          example: error
        errorCode:
          type: string
          description: Unique code identifying the error type
          example: "AUTH_FAILED"
        message:
          type: string
          description: Human-readable error message
          example: "Authentication failed for user"
        severity:
          type: string
          enum: [low, medium, high, critical]
          description: Severity level of the error
          example: "high"

    EventResponse:
      type: object
      description: Response after creating an event
      required:
        - id
        - status
        - event
      properties:
        id:
          type: string
          description: Unique identifier for the created event
          example: "event_456"
        status:
          type: string
          enum: [created, processed, failed]
          description: Status of the event processing
          example: "created"
        event:
          $ref: "#/components/schemas/EventRequest"

    Error:
      type: object
      description: Error response schema
      required:
        - code
        - message
      properties:
        code:
          type: string
          example: "INVALID_REQUEST"
        message:
          type: string
          example: "The request was invalid"
