# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  audience: audience.yml
  commons: commons.yml
  environment: environment.yml
  errors: errors.yml
  examples: examples.yml
  proto: proto.yml
  types: types.yml
  variables: variables.yml
  auth: auth.yml

types:
  HttpService:
    properties:
      availability: optional<commons.Availability>
      name: DeclaredServiceName
      displayName: optional<string>
      basePath: HttpPath
      endpoints: list<HttpEndpoint>
      headers: list<HttpHeader>
      pathParameters: list<PathParameter>
      encoding: optional<types.Encoding>
      transport: optional<Transport>
      audiences: optional<list<audience.AudienceReference>>

  DeclaredServiceName:
    properties:
      fernFilepath: commons.FernFilepath

  Transport:
    union:
      http: {}
      grpc: GrpcTransport

  GrpcTransport:
    properties:
      service: proto.ProtobufService

  HttpEndpoint:
    extends: commons.Declaration
    properties:
      id: commons.EndpointId
      name: EndpointName
      displayName: optional<string>
      method: HttpMethod
      headers: list<HttpHeader>
      baseUrl: optional<environment.EnvironmentBaseUrlId>
      v2BaseUrls: optional<list<environment.EnvironmentBaseUrlId>>
      basePath:
        type: optional<HttpPath>
        docs: Overrides the service and endpoint level base paths
      path: HttpPath
      fullPath: HttpPath
      pathParameters: list<PathParameter>
      allPathParameters: list<PathParameter>
      queryParameters: list<QueryParameter>
      requestBody: optional<HttpRequestBody>
      v2RequestBodies: optional<V2HttpRequestBodies>
      sdkRequest: optional<SdkRequest>
      response: optional<HttpResponse>
      v2Responses: optional<V2HttpResponses>
      errors: ResponseErrors
      auth: boolean
      security:
        type: optional<list<HttpEndpointSecurityItem>>
        docs: |
          A list of auth scheme collections. 
          To satisfy the security requirements, the caller must satisfy at least one collection of schemes.
      idempotent: boolean
      pagination: optional<Pagination>
      userSpecifiedExamples: list<UserSpecifiedEndpointExample>
      autogeneratedExamples: list<AutogeneratedEndpointExample>
      v2Examples: optional<examples.V2HttpEndpointExamples>
      transport: optional<Transport>
      source: optional<HttpEndpointSource>
      audiences: optional<list<audience.AudienceReference>>
      retries: optional<RetriesConfiguration>

  HttpEndpointSecurityItem:
    type: map<auth.AuthSchemeKey, list<auth.AuthScope>>
    docs: A collection of auth schemes that all need to be satisfied for the endpoint.

  RetriesConfiguration:
    discriminated: false
    union:
      - RetriesDisabledSchema

  RetriesDisabledSchema:
    properties:
      disabled: optional<boolean>

  HttpEndpointSource:
    union:
      proto: ProtoSourceInfo
      openapi: {}
      openrpc: {}

  ProtoSourceInfo:
    properties:
      methodType: optional<proto.ProtobufMethodType>

  EndpointName: commons.Name

  HttpPath:
    properties:
      head: string
      parts: list<HttpPathPart>

  HttpPathPart:
    properties:
      pathParameter: string
      tail: string

  HttpMethod:
    enum:
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE
      - HEAD

  HttpHeader:
    extends: commons.Declaration
    properties:
      name: commons.NameAndWireValue
      valueType: types.TypeReference
      env: optional<string>
      v2Examples: optional<examples.V2SchemaExamples>

  PathParameter:
    extends: commons.WithDocs
    properties:
      name: commons.Name
      valueType: types.TypeReference
      location: PathParameterLocation
      variable: optional<variables.VariableId>
      v2Examples: optional<examples.V2SchemaExamples>

  PathParameterLocation:
    enum:
      - ROOT
      - SERVICE
      - ENDPOINT

  QueryParameter:
    extends: commons.Declaration
    properties:
      name: commons.NameAndWireValue
      valueType: types.TypeReference
      allowMultiple: boolean
      v2Examples: optional<examples.V2SchemaExamples>

  HttpRequestBody:
    union:
      inlinedRequestBody: InlinedRequestBody
      reference: HttpRequestBodyReference
      fileUpload: FileUploadRequest
      bytes: BytesRequest

  V2HttpRequestBodies:
    properties:
      requestBodies: optional<list<HttpRequestBody>>

  InlinedRequestBody:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples
      - commons.WithContentType
    properties:
      name: commons.Name
      extends: list<types.DeclaredTypeName>
      properties: list<InlinedRequestBodyProperty>
      extendedProperties:
        type: optional<list<types.ObjectProperty>>
        docs: A list of properties that all the parents of this request have.
      extra-properties:
        docs: Whether to allow extra properties on the request.
        type: boolean

  InlinedRequestBodyProperty:
    extends: commons.WithDocsAndAvailability
    properties:
      name: commons.NameAndWireValue
      valueType: types.TypeReference
      v2Examples: optional<examples.V2SchemaExamples>
      propertyAccess: optional<types.ObjectPropertyAccess>

  FileUploadRequest:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples
      - commons.WithContentType
    properties:
      name: commons.Name
      properties: list<FileUploadRequestProperty>

  BytesRequest:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples
      - commons.WithContentType
    properties:
      isOptional: boolean

  FileUploadRequestProperty:
    union:
      file: FileProperty
      bodyProperty: FileUploadBodyProperty

  FileUploadBodyProperty:
    extends:
      - InlinedRequestBodyProperty
      - commons.WithContentType
    properties:
      style: optional<FileUploadBodyPropertyEncoding>

  FileUploadBodyPropertyEncoding:
    enum:
      - exploded
      - json
      - form

  FileProperty:
    union:
      file: FilePropertySingle
      fileArray: FilePropertyArray

  FilePropertySingle:
    extends: commons.WithDocs
    properties:
      key: commons.NameAndWireValue
      isOptional: boolean
      contentType: optional<string>

  FilePropertyArray:
    extends: commons.WithDocs
    properties:
      key: commons.NameAndWireValue
      isOptional: boolean
      contentType: optional<string>

  HttpRequestBodyReference:
    extends:
      - commons.WithDocs
      - commons.WithContentType
      - examples.WithV2Examples
    properties:
      requestBodyType: types.TypeReference

  SdkRequestBodyType:
    union:
      typeReference: HttpRequestBodyReference
      bytes: BytesRequest

  SdkRequest:
    properties:
      streamParameter:
        type: optional<RequestProperty>
        docs: |
          The request property that controls whether or not the response is streamed.
      requestParameterName: commons.Name
      shape: SdkRequestShape

  SdkRequestShape:
    union:
      justRequestBody: SdkRequestBodyType
      wrapper: SdkRequestWrapper

  SdkRequestWrapper:
    properties:
      wrapperName: commons.Name
      bodyKey: commons.Name
      includePathParameters: optional<boolean>
      onlyPathParameters: optional<boolean>

  HttpResponse:
    properties:
      status-code: optional<integer>
      body: optional<HttpResponseBody>

  V2HttpResponses:
    properties:
      responses: optional<list<HttpResponse>>

  NonStreamHttpResponseBody:
    union:
      json: JsonResponse
      fileDownload: FileDownloadResponse
      text: TextResponse
      bytes: BytesResponse

  HttpResponseBody:
    union:
      json: JsonResponse
      fileDownload: FileDownloadResponse
      text: TextResponse
      bytes: BytesResponse
      streaming: StreamingResponse
      streamParameter:
        type: StreamParameterResponse
        docs: |
          If there is a parameter that controls whether the response is streaming or not. Note
          that if this is the response then `sdkRequest.streamParameter` will always be populated.

  JsonResponse:
    union:
      response: JsonResponseBody
      nestedPropertyAsResponse: JsonResponseBodyWithProperty

  JsonResponseBody:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples
    properties:
      responseBodyType: types.TypeReference

  JsonResponseBodyWithProperty:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples
    properties:
      responseBodyType: types.TypeReference
      responseProperty:
        docs: |
          If set, the SDK will return this property from
          the response, rather than the response itself.

          This is particularly useful for JSON API structures
          (e.g. configure 'data' to return 'response.data').
        type: optional<types.ObjectProperty>

  FileDownloadResponse:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples

  TextResponse:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples

  BytesResponse:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples

  StreamParameterResponse:
    properties:
      nonStreamResponse: NonStreamHttpResponseBody
      streamResponse: StreamingResponse

  StreamingResponse:
    union:
      json: JsonStreamChunk
      text: TextStreamChunk
      sse: SseStreamChunk

  TextStreamChunk:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples
    properties: {}

  JsonStreamChunk:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples
    properties:
      payload: types.TypeReference
      terminator: optional<string>

  SseStreamChunk:
    extends:
      - commons.WithDocs
      - examples.WithV2Examples
    properties:
      payload: types.TypeReference
      terminator: optional<string>

  ResponseErrors: list<ResponseError>

  ResponseError:
    extends: commons.WithDocs
    properties:
      error: errors.DeclaredErrorName

  Pagination:
    docs: |
      If set, the endpoint will be generated with auto-pagination features.
    union:
      cursor: CursorPagination
      offset: OffsetPagination
      custom: CustomPagination

  CursorPagination:
    docs: |
      If set, the endpoint will be generated with auto-pagination features.

      The page must be defined as a property defined on the request, whereas
      the next page and results are resolved from properties defined on the
      response.
    properties:
      page: RequestProperty
      next: ResponseProperty
      results: ResponseProperty

  OffsetPagination:
    docs: |
      The page must be defined as a query parameter included in the request,
      whereas the results are resolved from properties defined on the response.

      The page index is auto-incremented between every additional page request.
    properties:
      page: RequestProperty
      results: ResponseProperty
      hasNextPage:
        docs: A response property that indicates whether there is a next page or not.
        type: optional<ResponseProperty>
      step:
        docs: |
          The step size used to increment the page offset between every new page.
        type: optional<RequestProperty>

  CustomPagination:
    docs: |
      Pagination where the SDK author is responsible for implementing the pagination
      logic in the SDK.
    properties:
      results:
        docs: |
          The response property is used to determine the results response type
          generated in the endpoint.
        type: ResponseProperty

  # shared properties
  RequestPropertyValue:
    union:
      query: QueryParameter
      body: types.ObjectProperty

  PropertyPathItem:
    properties:
      name: commons.Name
      type: types.TypeReference

  RequestProperty:
    docs: |
      A property associated with an endpoint's request.
    properties:
      propertyPath:
        docs: |
          If empty, the property is defined at the top-level.
          Otherwise, the property is defined on the nested object identified
          by the path.
        type: optional<list<PropertyPathItem>>
      property: RequestPropertyValue

  ResponseProperty:
    docs: |
      A property associated with a paginated endpoint's request or response.
    properties:
      propertyPath:
        docs: |
          If empty, the property is defined at the top-level.
          Otherwise, the property is defined on the nested object identified
          by the path.
        type: optional<list<PropertyPathItem>>
      property: types.ObjectProperty

  # examples
  AutogeneratedEndpointExample:
    properties:
      example: ExampleEndpointCall

  UserSpecifiedEndpointExample:
    properties:
      codeSamples:
        type: optional<list<ExampleCodeSample>>
        docs: Manually written code samples specified by the user
      example:
        type: optional<ExampleEndpointCall>
        docs: Manually written example specified by the user

  ExampleEndpointCall:
    extends: commons.WithDocs
    properties:
      id: optional<string>
      name: optional<commons.Name>
      url: string
      rootPathParameters: list<ExamplePathParameter>
      servicePathParameters: list<ExamplePathParameter>
      endpointPathParameters: list<ExamplePathParameter>
      serviceHeaders: list<ExampleHeader>
      endpointHeaders: list<ExampleHeader>
      queryParameters: list<ExampleQueryParameter>
      request: optional<ExampleRequestBody>
      response: ExampleResponse

  ExampleCodeSample:
    availability: in-development
    union:
      language: ExampleCodeSampleLanguage
      sdk: ExampleCodeSampleSdk

  ExampleCodeSampleLanguage:
    docs: |
      This is intended to co-exist with the auto-generated code samples.
    extends: commons.WithDocs
    properties:
      name:
        type: optional<commons.Name>
        docs: Override the example name.
      language: string
      code: string
      install:
        type: optional<string>
        docs: |
          The command to install the dependencies for the code sample.
          For example, `npm install` or `pip install -r requirements.txt`.

  ExampleCodeSampleSdk:
    docs: |
      This will be used to replace the auto-generated code samples.
    extends: commons.WithDocs
    properties:
      name:
        type: optional<commons.Name>
        docs: Override the example name.
      sdk: SupportedSdkLanguage
      code: string

  # be sure to keep this in sync with the list of supported Fern SDK languages
  SupportedSdkLanguage:
    enum:
      - curl
      - python
      - javascript
      - typescript
      - go
      - ruby
      - csharp
      - java
      - php
      - rust
      - swift

  ExamplePathParameter:
    properties:
      name: commons.Name
      value: types.ExampleTypeReference

  ExampleQueryParameter:
    properties:
      name: commons.NameAndWireValue
      value: types.ExampleTypeReference
      shape: optional<ExampleQueryParameterShape>

  ExampleQueryParameterShape:
    union:
      single: {}
      exploded: {}
      commaSeparated: {}

  ExampleHeader:
    properties:
      name: commons.NameAndWireValue
      value: types.ExampleTypeReference

  ExampleRequestBody:
    union:
      inlinedRequestBody: ExampleInlinedRequestBody
      reference: types.ExampleTypeReference
      fileUpload: ExampleFileUploadRequestBody

  ExampleInlinedRequestBody:
    extends: commons.WithJsonExample
    properties:
      properties: list<ExampleInlinedRequestBodyProperty>
      extraProperties: optional<list<ExampleInlinedRequestBodyExtraProperty>>

  ExampleInlinedRequestBodyExtraProperty:
    properties:
      name: commons.NameAndWireValue
      value: types.ExampleTypeReference

  ExampleInlinedRequestBodyProperty:
    properties:
      name: commons.NameAndWireValue
      value: types.ExampleTypeReference
      originalTypeDeclaration:
        docs: |
          This property may have been brought in via extension. originalTypeDeclaration
          is the name of the type that contains this property
        type: optional<types.DeclaredTypeName>

  ExampleFileUploadRequestBody:
    extends: commons.WithJsonExample
    properties:
      files: list<ExampleFileProperty>
      properties: list<ExampleInlinedRequestBodyProperty>

  ExampleFileProperty:
    properties:
      name: commons.NameAndWireValue
      value: ExampleFile

  ExampleFile:
    union:
      single: ExampleFileSingle
      array: list<ExampleFileSingle>

  ExampleFileSingle:
    properties:
      filename: string
      contentType: optional<string>

  ExampleResponse:
    union:
      ok: ExampleEndpointSuccessResponse
      error: ExampleEndpointErrorResponse

  ExampleEndpointSuccessResponse:
    union:
      body: optional<types.ExampleTypeReference>
      stream: list<types.ExampleTypeReference>
      sse: list<ExampleServerSideEvent>

  ExampleServerSideEvent:
    properties:
      event: string
      data: types.ExampleTypeReference

  ExampleEndpointErrorResponse:
    properties:
      error: errors.DeclaredErrorName
      body: optional<types.ExampleTypeReference>
